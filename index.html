<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SoilArk - Estate Management Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #0d9488;
            --primary-dark: #134e4a;
            --primary-light: #5eead4;
            --bg-main: #f8faf9;
            --bg-sidebar: #0f766e;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --text-white: #ffffff;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-main);
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--bg-sidebar) 0%, var(--primary-dark) 100%);
            color: var(--text-white);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
            z-index: 100;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-weight: 700;
            font-size: 16px;
        }

        .user-details h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-role {
            font-size: 12px;
            opacity: 0.8;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .estate-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .estate-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .estate-stats {
            display: grid;
            gap: 8px;
            margin-top: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            opacity: 0.9;
        }

        .stat-value {
            font-weight: 600;
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-left: 3px solid var(--primary-light);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: white;
            padding: 16px 32px;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            z-index: 50;
        }

        .top-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            width: 250px;
            transition: var(--transition);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .add-task-btn {
            padding: 10px 20px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-task-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .notification-btn {
            position: relative;
            padding: 10px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-btn:hover {
            background: var(--hover-bg);
            border-color: var(--primary-green);
        }

        .notification-icon {
            font-size: 20px;
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #dc2626;
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* Notifications Center */
        .notifications-panel {
            display: none;
            position: fixed;
            top: 80px;
            right: 32px;
            width: 420px;
            max-height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .notifications-panel.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notifications-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-title {
            font-size: 18px;
            font-weight: 700;
        }

        .notifications-actions {
            display: flex;
            gap: 8px;
        }

        .notification-action-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-action-btn:hover {
            background: var(--hover-bg);
        }

        .notification-tabs {
            display: flex;
            padding: 12px 20px;
            gap: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .notification-tab {
            padding: 6px 12px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
        }

        .notification-tab:hover {
            background: var(--hover-bg);
        }

        .notification-tab.active {
            background: var(--primary-green);
            color: white;
        }

        .notifications-list {
            flex: 1;
            overflow-y: auto;
            max-height: 450px;
        }

        .notification-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .notification-item:hover {
            background: var(--hover-bg);
        }

        .notification-item.unread {
            background: #f0fdfa;
        }

        .notification-item.unread::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: var(--primary-green);
            border-radius: 50%;
        }

        .notification-content {
            display: flex;
            gap: 12px;
        }

        .notification-icon-box {
            width: 40px;
            height: 40px;
            background: var(--bg-main);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .notification-icon-box.task {
            background: #dbeafe;
        }

        .notification-icon-box.field {
            background: #dcfce7;
        }

        .notification-icon-box.alert {
            background: #fee2e2;
        }

        .notification-icon-box.system {
            background: #fef3c7;
        }

        .notification-details {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.4;
            margin-bottom: 6px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--text-light);
        }

        .notification-empty {
            padding: 40px 20px;
            text-align: center;
            color: var(--text-light);
        }

        .notification-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px 32px;
        }

        /* Map View */
        .map-view {
            display: none;
            height: 100%;
        }

        .map-view.active {
            display: flex;
            gap: 20px;
        }

        .map-container {
            flex: 1;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .map-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .field-overlay {
            position: absolute;
            border: 3px solid var(--primary-light);
            cursor: pointer;
            transition: var(--transition);
            background: rgba(13, 148, 136, 0.1);
        }

        .field-overlay:hover {
            background: rgba(13, 148, 136, 0.2);
            border-color: var(--primary-green);
            transform: scale(1.02);
        }

        .field-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 700;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            text-align: center;
        }

        .map-controls {
            position: absolute;
            left: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .map-control-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }

        .map-control-btn:hover {
            background: var(--hover-bg);
            transform: scale(1.05);
        }

        /* Overview View Switcher */
        .overview-view-switcher {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 4px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
            width: fit-content;
        }

        .view-switch-btn {
            padding: 10px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .view-switch-btn:hover {
            background: var(--hover-bg);
        }

        .view-switch-btn.active {
            background: var(--primary-green);
            color: white;
        }

        /* Calendar View */
        .calendar-view {
            display: none;
            flex-direction: column;
            height: 100%;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-md);
        }

        .calendar-view.active {
            display: flex;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .calendar-title-section h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .calendar-title-section p {
            color: var(--text-light);
            font-size: 14px;
        }

        .calendar-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-navigation {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-nav-btn {
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }

        .calendar-nav-btn:hover {
            background: var(--hover-bg);
        }

        .calendar-current-period {
            font-size: 18px;
            font-weight: 700;
            min-width: 180px;
            text-align: center;
        }

        .calendar-today-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-today-btn:hover {
            background: var(--hover-bg);
        }

        .calendar-view-toggles {
            display: flex;
            gap: 4px;
            background: var(--bg-main);
            padding: 4px;
            border-radius: 8px;
        }

        .calendar-view-btn {
            padding: 8px 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .calendar-view-btn:hover {
            background: white;
        }

        .calendar-view-btn.active {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .calendar-filters {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 12px;
        }

        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 13px;
            user-select: none;
        }

        .filter-checkbox input[type="checkbox"] {
            cursor: pointer;
        }

        .filter-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .filter-dropdowns {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--bg-main);
            padding: 12px 8px;
            text-align: center;
            font-weight: 700;
            font-size: 13px;
            color: var(--text-dark);
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: var(--hover-bg);
        }

        .calendar-day.today {
            background: #dbeafe;
        }

        .calendar-day.today .day-number {
            background: #3b82f6;
            color: white;
        }

        .calendar-day.weekend {
            background: #f9fafb;
        }

        .calendar-day.other-month {
            background: #f3f4f6;
            opacity: 0.5;
        }

        .day-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .calendar-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .calendar-event {
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-event:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }

        .calendar-event.task {
            background: #dbeafe;
            color: #1e40af;
        }

        .calendar-event.task.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .calendar-event.task.medium {
            background: #fed7aa;
            color: #9a3412;
        }

        .calendar-event.task.low {
            background: #d1fae5;
            color: #065f46;
        }

        .calendar-event.machinery-service {
            background: #fef3c7;
            color: #92400e;
        }

        .calendar-event.machinery-mot {
            background: #fee2e2;
            color: #991b1b;
        }

        .calendar-event.holidays {
            background: #ede9fe;
            color: #5b21b6;
        }

        .calendar-event.holidays.multi-day {
            border-radius: 4px 0 0 4px;
        }

        .calendar-event.holidays.multi-day-continue {
            border-radius: 0;
            padding-left: 12px;
        }

        .calendar-event.holidays.multi-day-end {
            border-radius: 0 4px 4px 0;
        }

        .calendar-event.rota {
            background: #d1fae5;
            color: #065f46;
        }

        .calendar-event.sick {
            background: #fce7f3;
            color: #9f1239;
        }

        .calendar-event.field-activities {
            background: #ccfbf1;
            color: #134e4a;
        }

        .event-icon {
            font-size: 12px;
        }

        .event-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Agenda View */
        .calendar-agenda-view {
            overflow-y: auto;
        }

        .agenda-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .agenda-section {
            border-left: 3px solid var(--primary-green);
            padding-left: 16px;
        }

        .agenda-date {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .agenda-event {
            display: flex;
            gap: 16px;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .agenda-event:hover {
            background: var(--hover-bg);
        }

        .event-time {
            font-weight: 700;
            font-size: 13px;
            min-width: 80px;
            color: var(--text-light);
        }

        .event-details {
            flex: 1;
        }

        .event-details .event-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .event-meta {
            font-size: 13px;
            color: var(--text-light);
        }

        /* Field Detail Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.2s;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .field-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .modal-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--hover-bg);
            color: var(--text-dark);
        }

        .modal-body {
            padding: 24px;
        }

        .status-badge {
            display: inline-flex;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .status-badge.active {
            background: #dcfce7;
            color: #166534;
        }

        .field-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .info-item {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .info-value.good {
            color: #16a34a;
        }

        .modal-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .expand-field-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary-green);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 24px;
        }

        .expand-field-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Field Detail Tab View */
        .field-detail-view {
            display: none;
            height: 100%;
            flex-direction: column;
        }

        .field-detail-view.active {
            display: flex;
        }

        .field-detail-header {
            background: white;
            padding: 20px 32px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .field-detail-title-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-to-map-btn {
            background: var(--hover-bg);
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
        }

        .back-to-map-btn:hover {
            background: var(--border-color);
        }

        .field-detail-title {
            font-size: 24px;
            font-weight: 700;
        }

        .field-detail-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        .field-detail-actions {
            display: flex;
            gap: 12px;
        }

        .field-action-btn {
            padding: 10px 18px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .field-action-btn:hover {
            background: var(--hover-bg);
            border-color: var(--primary-green);
        }

        .field-action-btn.primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .field-action-btn.primary:hover {
            background: var(--primary-dark);
        }

        .field-detail-content {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            background: var(--bg-main);
        }

        .field-detail-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .field-detail-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .field-detail-card h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        /* Task Detail Modal */
        .task-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .task-modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .task-modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .task-modal-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: var(--text-light);
        }

        .task-modal-body {
            padding: 24px;
        }

        .task-section {
            margin-bottom: 24px;
        }

        .task-section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-description {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .task-assignee-card {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .assignee-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
        }

        .assignee-info h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .assignee-info p {
            font-size: 13px;
            color: var(--text-light);
        }

        .task-status-selector {
            display: flex;
            gap: 8px;
        }

        .status-option {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        .status-option:hover {
            border-color: var(--primary-green);
            background: var(--hover-bg);
        }

        .status-option.selected {
            border-color: var(--primary-green);
            background: var(--primary-green);
            color: white;
        }

        .task-notes-area {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: var(--transition);
        }

        .task-notes-area:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .task-modal-actions {
            display: flex;
            gap: 12px;
            padding: 24px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-main);
        }

        .task-modal-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .task-modal-btn:hover {
            background: var(--hover-bg);
        }

        .task-modal-btn.primary {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .task-modal-btn.primary:hover {
            background: var(--primary-dark);
        }

        .task-modal-btn.danger {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }

        .task-modal-btn.danger:hover {
            background: #991b1b;
        }

        .photo-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .photo-upload-area:hover {
            border-color: var(--primary-green);
            background: var(--hover-bg);
        }

        .photo-upload-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .photo-upload-text {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Add Task Modal */
        .add-task-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .form-label.required::after {
            content: ' *';
            color: #dc2626;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .form-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: var(--transition);
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            cursor: pointer;
            transition: var(--transition);
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .priority-options {
            display: flex;
            gap: 12px;
        }

        .priority-option {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 14px;
            font-weight: 600;
        }

        .priority-option:hover {
            border-color: var(--primary-green);
            background: var(--hover-bg);
        }

        .priority-option.selected {
            border-color: var(--primary-green);
            background: var(--primary-green);
            color: white;
        }

        .priority-option.high.selected {
            border-color: #dc2626;
            background: #dc2626;
        }

        .priority-option.medium.selected {
            border-color: #f59e0b;
            background: #f59e0b;
        }

        /* Operations Drill-Down Modal */
        .ops-detail-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ops-modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .ops-modal-title-section h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .ops-modal-subtitle {
            color: var(--text-light);
            font-size: 14px;
        }

        .ops-modal-body {
            padding: 24px;
        }

        .ops-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .ops-summary-card {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
        }

        .ops-summary-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ops-summary-value {
            font-size: 24px;
            font-weight: 700;
        }

        .ops-summary-change {
            font-size: 13px;
            font-weight: 600;
            margin-top: 4px;
        }

        .ops-summary-change.positive {
            color: #16a34a;
        }

        .ops-summary-change.negative {
            color: #dc2626;
        }

        .ops-modal-period-selector {
            display: flex;
            gap: 8px;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-main);
        }

        .period-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .period-btn:hover {
            background: var(--hover-bg);
        }

        .period-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .show-all-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--primary-green);
        }

        .show-all-btn:hover {
            background: var(--primary-green);
            color: white;
        }

        .show-all-btn.active {
            background: var(--primary-green);
            color: white;
        }

        .transaction-filters {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .subcategory-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .subcategory-item {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .subcategory-item:hover {
            background: var(--hover-bg);
            border-left-color: var(--primary-green);
            transform: translateX(4px);
        }

        .subcategory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .subcategory-name {
            font-weight: 600;
            font-size: 15px;
        }

        .subcategory-amount {
            font-weight: 700;
            font-size: 18px;
        }

        .subcategory-amount.cost {
            color: #dc2626;
        }

        .subcategory-amount.revenue {
            color: #16a34a;
        }

        .subcategory-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            font-size: 13px;
            color: var(--text-light);
        }

        .subcategory-detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .subcategory-detail-label {
            font-weight: 600;
            color: var(--text-dark);
        }

        .subcategory-progress {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .subcategory-progress-fill {
            height: 100%;
            background: var(--primary-green);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .analytics-card {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 8px;
        }

        .analytics-card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-light);
        }

        .analytics-card-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .analytics-card-detail {
            font-size: 13px;
            color: var(--text-light);
        }

        .ops-detail-section {
            margin-bottom: 24px;
        }

        .ops-detail-section h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .transaction-item {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .transaction-item:hover {
            background: var(--hover-bg);
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .transaction-meta {
            font-size: 13px;
            color: var(--text-light);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 18px;
            text-align: right;
        }

        .transaction-amount.expense {
            color: #dc2626;
        }

        .transaction-amount.revenue {
            color: #16a34a;
        }

        .trend-chart {
            background: var(--bg-main);
            padding: 20px;
            border-radius: 8px;
        }

        .field-breakdown-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .field-profit-card {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .field-profit-card:hover {
            background: var(--hover-bg);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .field-profit-name {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .field-profit-details {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .field-profit-amount {
            font-size: 20px;
            font-weight: 700;
            color: #16a34a;
        }

        .action-btn {
            padding: 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: var(--hover-bg);
            border-color: var(--primary-green);
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-main);
            border-radius: 8px;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
        }

        .task-item:hover {
            background: var(--hover-bg);
            transform: translateX(2px);
        }

        .task-item.high {
            border-left-color: #dc2626;
        }

        .task-item.medium {
            border-left-color: #f59e0b;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .task-meta {
            font-size: 12px;
            color: var(--text-light);
        }

        .task-priority {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .task-priority.high {
            background: #fef2f2;
            color: #991b1b;
        }

        .task-priority.medium {
            background: #fffbeb;
            color: #92400e;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-item {
            padding: 12px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .history-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .history-meta {
            font-size: 12px;
            color: var(--text-light);
        }

        /* Task Management View */
        .task-view {
            display: none;
        }

        .task-view.active {
            display: block;
        }

        .task-header {
            margin-bottom: 24px;
        }

        .task-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .task-header p {
            color: var(--text-light);
            font-size: 14px;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            height: calc(100vh - 240px);
        }

        .kanban-column {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 16px;
        }

        .column-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .column-indicator.todo {
            background: #3b82f6;
        }

        .column-indicator.progress {
            background: #f59e0b;
        }

        .column-indicator.done {
            background: #10b981;
        }

        .column-count {
            background: var(--bg-main);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
        }

        .column-tasks {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-card {
            background: var(--bg-main);
            padding: 16px;
            border-radius: 10px;
            cursor: move;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }

        .task-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .task-card.high-priority {
            border-left-color: #dc2626;
        }

        .task-card.medium-priority {
            border-left-color: #f59e0b;
        }

        .task-card-title {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 8px;
        }

        .task-card-desc {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .task-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .assignee-icon {
            font-size: 14px;
        }

        .task-location {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-light);
        }

        .task-date {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-light);
        }

        .task-card-tags {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        .task-tag {
            padding: 3px 8px;
            background: white;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Operations View */
        .ops-view {
            display: none;
        }

        .ops-view.active {
            display: block;
        }

        /* Staff View */
        .staff-view {
            display: none;
        }

        .staff-view.active {
            display: block;
        }

        .staff-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 16px;
        }

        .staff-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .staff-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .staff-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background: var(--hover-bg);
        }

        .filter-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .staff-actions-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-btn:hover {
            background: var(--hover-bg);
            border-color: var(--primary-green);
        }

        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .staff-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .staff-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--primary-green);
        }

        .staff-card-header {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .staff-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
            flex-shrink: 0;
        }

        .staff-card-info {
            flex: 1;
        }

        .staff-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .staff-role {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .staff-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .staff-status.working {
            background: #dcfce7;
            color: #166534;
        }

        .staff-status.holiday {
            background: #dbeafe;
            color: #1e40af;
        }

        .staff-status.sick {
            background: #fee2e2;
            color: #991b1b;
        }

        .staff-card-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .staff-stat {
            font-size: 12px;
        }

        .staff-stat-label {
            color: var(--text-light);
            margin-bottom: 2px;
        }

        .staff-stat-value {
            font-weight: 600;
            font-size: 14px;
        }

        /* Staff Detail Modal */
        .staff-detail-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .staff-detail-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .staff-detail-profile {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .staff-detail-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 32px;
        }

        .staff-detail-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .staff-detail-tabs {
            display: flex;
            gap: 8px;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .staff-tab {
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .staff-tab:hover {
            color: var(--primary-green);
        }

        .staff-tab.active {
            color: var(--primary-green);
            border-bottom-color: var(--primary-green);
        }

        .staff-detail-content {
            padding: 24px;
        }

        .staff-tab-content {
            display: none;
        }

        .staff-tab-content.active {
            display: block;
        }

        .staff-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .staff-info-item {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .staff-info-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .staff-info-value {
            font-size: 15px;
            font-weight: 600;
        }

        .staff-section {
            margin-bottom: 24px;
        }

        .staff-section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-dark);
        }

        .staff-important-note {
            padding: 16px;
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            margin-top: 12px;
        }

        .staff-important-note-title {
            font-weight: 700;
            margin-bottom: 4px;
            color: #92400e;
        }

        .staff-important-note-text {
            font-size: 14px;
            color: #78350f;
        }

        .staff-leave-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .staff-leave-card {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
            text-align: center;
        }

        .staff-leave-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 4px;
        }

        .staff-leave-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .staff-documents-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .staff-document-item {
            padding: 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .staff-document-name {
            font-weight: 600;
            font-size: 14px;
        }

        .staff-notes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .staff-note-item {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .staff-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .staff-note-date {
            font-size: 12px;
            color: var(--text-light);
        }

        .staff-note-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* Machinery View */
        .machinery-view {
            display: none;
        }

        .machinery-view.active {
            display: block;
        }

        .machinery-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 16px;
        }

        .machinery-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .machinery-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .machinery-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            overflow-x: auto;
        }

        .machinery-tab {
            padding: 8px 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .machinery-tab:hover {
            background: var(--hover-bg);
        }

        .machinery-tab.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .machinery-actions-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .machinery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .machinery-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .machinery-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--primary-green);
        }

        .machinery-card-header {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .machinery-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            flex-shrink: 0;
        }

        .machinery-card-info {
            flex: 1;
        }

        .machinery-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .machinery-model {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .machinery-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .machinery-status.active {
            background: #dcfce7;
            color: #166534;
        }

        .machinery-status.barn {
            background: #dbeafe;
            color: #1e40af;
        }

        .machinery-status.maintenance {
            background: #fef3c7;
            color: #92400e;
        }

        .machinery-status.sold {
            background: #f3f4f6;
            color: #6b7280;
        }

        .machinery-card-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .machinery-detail {
            font-size: 12px;
        }

        .machinery-detail-label {
            color: var(--text-light);
            margin-bottom: 2px;
        }

        .machinery-detail-value {
            font-weight: 600;
            font-size: 14px;
        }

        .machinery-service-due {
            grid-column: 1 / -1;
            padding: 8px 12px;
            background: #fef3c7;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #92400e;
            text-align: center;
        }

        .machinery-service-due.urgent {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Machinery Detail Modal */
        .machinery-detail-modal {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 1000px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .machinery-detail-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .machinery-detail-profile {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .machinery-detail-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .machinery-detail-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .machinery-detail-tabs {
            display: flex;
            gap: 8px;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .machinery-tab-btn {
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .machinery-tab-btn:hover {
            color: var(--primary-green);
        }

        .machinery-tab-btn.active {
            color: var(--primary-green);
            border-bottom-color: var(--primary-green);
        }

        .machinery-detail-content {
            padding: 24px;
        }

        .machinery-tab-content {
            display: none;
        }

        .machinery-tab-content.active {
            display: block;
        }

        .machinery-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .machinery-info-item {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .machinery-info-label {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .machinery-info-value {
            font-size: 15px;
            font-weight: 600;
        }

        .machinery-section {
            margin-bottom: 24px;
        }

        .machinery-section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--primary-dark);
        }

        .service-schedule-box {
            padding: 20px;
            background: var(--bg-main);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .service-interval-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .service-interval-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .service-interval-option:hover {
            border-color: var(--primary-green);
        }

        .service-interval-option.selected {
            border-color: var(--primary-green);
            background: #f0fdfa;
        }

        .service-interval-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .service-interval-option.selected .service-interval-checkbox {
            background: var(--primary-green);
            border-color: var(--primary-green);
        }

        .service-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .service-history-table th {
            background: var(--bg-main);
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-light);
        }

        .service-history-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .service-history-table tr:hover {
            background: var(--hover-bg);
        }

        .cost-summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .cost-summary-card {
            padding: 16px;
            background: var(--bg-main);
            border-radius: 8px;
            text-align: center;
        }

        .cost-summary-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 4px;
        }

        .cost-summary-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .cost-breakdown-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cost-breakdown-item {
            padding: 16px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cost-breakdown-info {
            flex: 1;
        }

        .cost-breakdown-category {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .cost-breakdown-detail {
            font-size: 12px;
            color: var(--text-light);
        }

        .cost-breakdown-amount {
            font-weight: 700;
            font-size: 18px;
            color: #dc2626;
        }

        .machinery-documents-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .machinery-document-item {
            padding: 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .machinery-document-name {
            font-weight: 600;
            font-size: 14px;
        }

        .serial-plate-photo {
            max-width: 300px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            margin-top: 12px;
        }

        .ops-header {
            margin-bottom: 24px;
        }

        .ops-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .ops-header p {
            color: var(--text-light);
            font-size: 14px;
        }

        .ops-section {
            margin-bottom: 32px;
        }

        .ops-section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-dark);
        }

        .ops-category-grid {
            display: grid;
            gap: 20px;
        }

        .ops-category-grid.primary {
            grid-template-columns: repeat(2, 1fr);
        }

        .ops-category-grid.secondary {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .ops-category-grid.revenue {
            grid-template-columns: repeat(3, 1fr);
        }

        .ops-category-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .ops-category-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-green);
        }

        .ops-category-card.primary {
            padding: 32px;
        }

        .ops-category-card.primary .ops-category-icon {
            width: 80px;
            height: 80px;
            font-size: 40px;
        }

        .ops-category-card.primary .ops-category-amount {
            font-size: 36px;
        }

        .ops-category-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }

        .ops-category-card.revenue .ops-category-icon {
            background: linear-gradient(135deg, #16a34a, #22c55e);
        }

        .ops-category-info {
            flex: 1;
        }

        .ops-category-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .ops-category-card.primary .ops-category-name {
            font-size: 20px;
        }

        .ops-category-amount {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .ops-category-amount.cost {
            color: #dc2626;
        }

        .ops-category-amount.revenue {
            color: #16a34a;
        }

        .ops-category-subtitle {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .ops-category-change {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ops-category-change.positive {
            color: #16a34a;
        }

        .ops-category-change.negative {
            color: #dc2626;
        }

        .ops-category-stats {
            font-size: 13px;
            color: var(--text-light);
        }

        .filter-bar {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-light);
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            background: white;
            transition: var(--transition);
        }

        .filter-select:hover {
            border-color: var(--primary-green);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .metric-change {
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metric-change.positive {
            color: #16a34a;
        }

        .metric-change.negative {
            color: #dc2626;
        }

        .ops-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .breakdown-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
        }

        .breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .breakdown-title {
            font-size: 18px;
            font-weight: 700;
        }

        .breakdown-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .breakdown-item:hover {
            background: var(--hover-bg);
            transform: translateX(4px);
        }

        .breakdown-name {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .breakdown-main {
            font-weight: 600;
            font-size: 14px;
        }

        .breakdown-sub {
            font-size: 12px;
            color: var(--text-light);
        }

        .breakdown-amount {
            font-weight: 700;
            font-size: 16px;
        }

        .breakdown-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-main);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 6px;
        }

        .breakdown-fill {
            height: 100%;
            background: var(--primary-green);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .kanban-board {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .ops-grid {
                grid-template-columns: 1fr;
            }

            .field-detail-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 200;
                transition: left 0.3s ease;
                max-height: 100vh;
                overflow-y: auto;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .main-content {
                width: 100%;
                margin-left: 0;
            }

            .top-bar {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 12px;
            }

            .top-actions {
                width: 100%;
                justify-content: space-between;
                flex-wrap: nowrap;
            }

            .search-box {
                flex: 1;
                min-width: 0;
            }

            .add-task-btn {
                padding: 8px 12px;
                font-size: 13px;
                white-space: nowrap;
            }

            .notification-btn {
                padding: 8px;
            }

            .content-area {
                padding: 16px;
                padding-top: 16px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 24px;
            }

            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            /* Mobile Menu Button */
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 40px;
                height: 40px;
                background: var(--primary-green);
                color: white;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 20px;
                flex-shrink: 0;
            }

            .mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 199;
            }

            .mobile-overlay.active {
                display: block;
            }

            /* Modals on mobile */
            .field-modal,
            .task-modal,
            .add-task-modal,
            .staff-detail-modal,
            .machinery-detail-modal,
            .ops-detail-modal {
                width: 95%;
                max-width: 95%;
                max-height: 90vh;
            }

            .modal-header {
                padding: 16px;
            }

            .modal-body {
                padding: 16px;
            }

            .task-modal-header {
                padding: 16px;
            }

            .task-modal-body {
                padding: 16px;
            }

            .task-modal-actions {
                padding: 16px;
                flex-direction: column;
            }

            .task-modal-btn {
                width: 100%;
            }

            /* Field detail view on mobile */
            .field-detail-header {
                padding: 16px;
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .field-detail-title-section {
                width: 100%;
            }

            .field-detail-actions {
                width: 100%;
                flex-wrap: wrap;
            }

            .field-action-btn {
                flex: 1;
                min-width: 120px;
            }

            .field-detail-content {
                padding: 16px;
            }

            .field-info-grid {
                grid-template-columns: 1fr;
            }

            /* Notifications on mobile */
            .notifications-panel {
                right: 0;
                left: 0;
                top: 70px;
                width: 100%;
                max-height: calc(100vh - 80px);
                border-radius: 12px 12px 0 0;
            }

            /* Form elements on mobile */
            .form-row {
                grid-template-columns: 1fr;
            }

            .priority-options {
                flex-direction: column;
            }

            /* Operations on mobile */
            .ops-summary-cards {
                grid-template-columns: 1fr;
            }

            .ops-category-grid.primary,
            .ops-category-grid.secondary,
            .ops-category-grid.revenue {
                grid-template-columns: 1fr;
            }

            .ops-category-card {
                flex-direction: column;
                align-items: flex-start;
            }

            .ops-category-card.primary .ops-category-icon {
                width: 60px;
                height: 60px;
                font-size: 32px;
            }

            .ops-category-card.primary .ops-category-amount {
                font-size: 28px;
            }

            .breakdown-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .field-breakdown-grid {
                grid-template-columns: 1fr;
            }

            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .transaction-filters {
                grid-template-columns: 1fr;
            }

            .subcategory-details {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .ops-modal-period-selector {
                flex-wrap: wrap;
            }

            .period-btn {
                flex: 1;
                min-width: 100px;
            }

            /* Map on mobile */
            .map-view {
                flex-direction: column;
            }

            /* Calendar on mobile */
            .overview-view-switcher {
                width: 100%;
                justify-content: center;
            }

            .view-switch-btn {
                flex: 1;
                padding: 8px 12px;
                font-size: 13px;
            }

            .calendar-view {
                padding: 16px;
            }

            .calendar-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .calendar-controls {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .calendar-navigation {
                justify-content: center;
            }

            .calendar-current-period {
                font-size: 16px;
                min-width: 140px;
            }

            .calendar-view-toggles {
                width: 100%;
            }

            .calendar-view-btn {
                flex: 1;
                padding: 6px 8px;
                font-size: 12px;
            }

            .calendar-filters {
                padding: 12px;
            }

            .filter-group {
                gap: 12px;
            }

            .filter-checkbox {
                font-size: 12px;
            }

            .filter-dropdowns {
                flex-direction: column;
                width: 100%;
            }

            .filter-dropdowns .form-select {
                width: 100%;
            }

            .calendar-day {
                min-height: 80px;
                padding: 4px;
            }

            .day-number {
                width: 20px;
                height: 20px;
                font-size: 11px;
            }

            .calendar-event {
                font-size: 10px;
                padding: 2px 4px;
            }

            .event-icon {
                font-size: 10px;
            }

            .calendar-day-header {
                padding: 8px 4px;
                font-size: 11px;
            }

            .agenda-event {
                flex-direction: column;
                gap: 8px;
            }

            .event-time {
                min-width: auto;
            }

            .map-container {
                height: 400px;
            }

            .field-label {
                font-size: 12px;
            }

            .map-controls {
                bottom: 10px;
                left: 10px;
            }

            .map-control-btn {
                width: 36px;
                height: 36px;
            }

            /* Task cards on mobile */
            .task-card {
                padding: 12px;
            }

            .task-card-title {
                font-size: 14px;
            }

            .task-card-desc {
                font-size: 12px;
            }

            /* Kanban columns on mobile */
            .column-tasks {
                max-height: 400px;
            }

            /* Machinery view on mobile */
            .machinery-grid {
                grid-template-columns: 1fr;
            }

            .machinery-summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .machinery-tabs {
                flex-direction: column;
            }

            .machinery-tab {
                width: 100%;
            }

            .machinery-actions-bar {
                flex-direction: column;
            }

            .machinery-detail-tabs {
                gap: 4px;
            }

            .machinery-tab-btn {
                font-size: 12px;
                padding: 8px 12px;
            }

            .machinery-info-grid {
                grid-template-columns: 1fr;
            }

            .cost-summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .service-history-table {
                font-size: 12px;
            }

            .service-history-table th,
            .service-history-table td {
                padding: 8px;
            }

            /* Sidebar adjustments */
            .estate-stats {
                font-size: 11px;
            }

            .stat-item {
                font-size: 11px;
            }

            /* Staff view on mobile */
            .staff-grid {
                grid-template-columns: 1fr;
            }

            .staff-summary-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .staff-filters {
                flex-direction: column;
            }

            .filter-btn {
                width: 100%;
            }

            .staff-actions-bar {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }

            .staff-detail-tabs {
                gap: 4px;
            }

            .staff-tab {
                font-size: 12px;
                padding: 8px 12px;
            }

            .staff-info-grid {
                grid-template-columns: 1fr;
            }

            .staff-leave-summary {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Touch-friendly sizing */
            .nav-item {
                padding: 14px 20px;
                font-size: 15px;
            }

            .task-item,
            .history-item,
            .breakdown-item {
                min-height: 48px;
            }
        }

        @media (max-width: 480px) {
            .modal-title {
                font-size: 20px;
            }

            .task-modal-title {
                font-size: 20px;
            }

            .field-detail-title {
                font-size: 20px;
            }

            .metric-card {
                padding: 16px;
            }

            .breakdown-card {
                padding: 16px;
            }

            .field-detail-card {
                padding: 16px;
            }

            .ops-modal-body {
                padding: 16px;
            }
        }

        /* Desktop-only elements */
        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }

            .mobile-overlay {
                display: none !important;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div class="user-info">
                        <div class="user-avatar">AB</div>
                        <div class="user-details">
                            <h3>User - ABT</h3>
                            <div class="user-role">MANAGER</div>
                        </div>
                    </div>
                    <button class="logout-btn"> Logout</button>
                </div>

                <div class="estate-info">
                    <div class="estate-name">
                         Landark Estate
                    </div>
                    <div style="font-size: 11px; opacity: 0.8; margin-top: 4px;">Farm Overview</div>
                    <div class="estate-stats">
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('total')">
                            <span>Total Hectares</span>
                            <span class="stat-value">567ha</span>
                        </div>
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('grassland')">
                            <span>Grassland</span>
                            <span class="stat-value">360ha</span>
                        </div>
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('crops')">
                            <span>Crops</span>
                            <span class="stat-value">125ha</span>
                        </div>
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('forestry')">
                            <span>Forestry</span>
                            <span class="stat-value">65ha</span>
                        </div>
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('buildings')">
                            <span>Buildings</span>
                            <span class="stat-value">17ha</span>
                        </div>
                        <div class="stat-item" style="cursor: pointer;" onclick="drillDownEstateStat('livestock')">
                            <span>Livestock</span>
                            <span class="stat-value">400</span>
                        </div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="switchView('overview')">
                    <span class="nav-icon"></span>
                    <span>Overview</span>
                </div>
                <div class="nav-item" onclick="switchView('tasks')">
                    <span class="nav-icon"></span>
                    <span>Tasks</span>
                </div>
                <div class="nav-item" onclick="switchView('staff')">
                    <span class="nav-icon"></span>
                    <span>Staff</span>
                </div>
                <div class="nav-item" onclick="switchView('machinery')">
                    <span class="nav-icon"></span>
                    <span>Machinery</span>
                </div>
                <div class="nav-item" onclick="switchView('operations')">
                    <span class="nav-icon"></span>
                    <span>Operation Management</span>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="top-actions">
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()"></button>
                    <input type="text" class="search-box" placeholder="Search fields, tasks, assets...">
                    <button class="notification-btn" onclick="openNotifications()">
                        <span class="notification-icon"></span>
                        <span class="notification-badge">5</span>
                    </button>
                    <button class="add-task-btn" onclick="openAddTaskModal()">
                        + Add Task
                    </button>
                </div>
            </div>

            <div class="content-area">
                <!-- Overview View Switcher -->
                <div class="overview-view-switcher">
                    <button class="view-switch-btn active" onclick="switchOverviewView('map')">
                         Map View
                    </button>
                    <button class="view-switch-btn" onclick="switchOverviewView('calendar')">
                         Calendar View
                    </button>
                </div>

                <!-- Map View -->
                <div class="map-view active" id="overviewMapView">
                    <div class="map-container">
                        <img src="./uploads/LandArkPrev.png" alt="Estate Map" class="map-image">
                        <div class="field-overlay" style="top: 11%; left: 27%; width: 21%; height: 18%;" onclick="showFieldDetail('North Pasture')">
                            <div class="field-label">North Pasture</div>
                        </div>
                        <div class="field-overlay" style="top: 48%; left: 13%; width: 24%; height: 21%;" onclick="showFieldDetail('West Orchard')">
                            <div class="field-label">West Orchard</div>
                        </div>
                        <div class="field-overlay" style="top: 16%; right: 17%; width: 22%; height: 23%;" onclick="showFieldDetail('South Crops')">
                            <div class="field-label">South Crops</div>
                        </div>
                        <div class="field-overlay" style="top: 51%; right: 15%; width: 24%; height: 25%;" onclick="showFieldDetail('East Meadow')">
                            <div class="field-label">East Meadow</div>
                        </div>
                        <div class="map-controls">
                            <button class="map-control-btn" title="Zoom In">+</button>
                            <button class="map-control-btn" title="Zoom Out"></button>
                            <button class="map-control-btn" title="Layers"></button>
                            <button class="map-control-btn" title="Fullscreen"></button>
                        </div>
                    </div>
                </div>

                <!-- Calendar View -->
                <div class="calendar-view" id="overviewCalendarView">
                    <div class="calendar-header">
                        <div class="calendar-title-section">
                            <h2>Estate Calendar</h2>
                            <p>Unified view of tasks, machinery, staff, and field activities</p>
                        </div>
                        <div class="calendar-actions">
                            <button class="add-task-btn" onclick="openAddEventModal()">
                                + Add Event
                            </button>
                        </div>
                    </div>

                    <!-- Calendar Controls -->
                    <div class="calendar-controls">
                        <div class="calendar-navigation">
                            <button class="calendar-nav-btn" onclick="previousMonth()"></button>
                            <div class="calendar-current-period" id="calendarCurrentPeriod">December 2025</div>
                            <button class="calendar-nav-btn" onclick="nextMonth()"></button>
                            <button class="calendar-today-btn" onclick="goToToday()">Today</button>
                        </div>
                        
                        <div class="calendar-view-toggles">
                            <button class="calendar-view-btn active" onclick="setCalendarView('month')">Month</button>
                            <button class="calendar-view-btn" onclick="setCalendarView('week')">Week</button>
                            <button class="calendar-view-btn" onclick="setCalendarView('day')">Day</button>
                            <button class="calendar-view-btn" onclick="setCalendarView('agenda')">Agenda</button>
                        </div>
                    </div>

                    <!-- Calendar Filters -->
                    <div class="calendar-filters">
                        <div class="filter-group">
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('tasks')">
                                <span class="filter-color" style="background: #3b82f6;"></span>
                                <span>Tasks</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('machinery-service')">
                                <span class="filter-color" style="background: #f59e0b;"></span>
                                <span>Machinery Service</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('machinery-mot')">
                                <span class="filter-color" style="background: #ef4444;"></span>
                                <span>MOT Dates</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('holidays')">
                                <span class="filter-color" style="background: #8b5cf6;"></span>
                                <span>Staff Holidays</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('rota')">
                                <span class="filter-color" style="background: #10b981;"></span>
                                <span>Staff Rota</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('sick')">
                                <span class="filter-color" style="background: #ec4899;"></span>
                                <span>Sick Days</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked onchange="toggleCalendarFilter('field-activities')">
                                <span class="filter-color" style="background: #14b8a6;"></span>
                                <span>Field Activities</span>
                            </label>
                        </div>
                        <div class="filter-dropdowns">
                            <select class="form-select" onchange="filterCalendarByPerson(this.value)">
                                <option value="">All People</option>
                                <option value="john">John Smith</option>
                                <option value="sarah">Sarah Johnson</option>
                                <option value="mike">Mike Wilson</option>
                            </select>
                            <select class="form-select" onchange="filterCalendarByMachine(this.value)">
                                <option value="">All Machines</option>
                                <option value="tractor1">Tractor #1</option>
                                <option value="tractor2">Tractor #2</option>
                                <option value="harvester">Combine Harvester</option>
                            </select>
                            <select class="form-select" onchange="filterCalendarByField(this.value)">
                                <option value="">All Fields</option>
                                <option value="north">North Pasture</option>
                                <option value="south">South Crops</option>
                                <option value="west">West Orchard</option>
                            </select>
                            <label class="filter-checkbox">
                                <input type="checkbox" onchange="filterHighPriorityOnly(this.checked)">
                                <span>High Priority Only</span>
                            </label>
                        </div>
                    </div>

                    <!-- Calendar Grid (Month View) -->
                    <div class="calendar-month-view" id="calendarMonthView">
                        <div class="calendar-grid">
                            <!-- Day Headers -->
                            <div class="calendar-day-header">Mon</div>
                            <div class="calendar-day-header">Tue</div>
                            <div class="calendar-day-header">Wed</div>
                            <div class="calendar-day-header">Thu</div>
                            <div class="calendar-day-header">Fri</div>
                            <div class="calendar-day-header">Sat</div>
                            <div class="calendar-day-header">Sun</div>

                            <!-- Previous Month Days (grayed out) -->
                            <div class="calendar-day other-month">
                                <div class="day-number">25</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">26</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">27</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">28</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">29</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">30</div>
                            </div>

                            <!-- December 2025 Days -->
                            <div class="calendar-day">
                                <div class="day-number">1</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task high" onclick="openEventDetail('task', 1)" title="Fix North Pasture Fence - High Priority">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Fix Fence</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="calendar-day">
                                <div class="day-number">2</div>
                                <div class="calendar-events">
                                    <div class="calendar-event rota" onclick="openEventDetail('rota', 2)" title="Staff Rota">
                                        <span class="event-icon"></span>
                                        <span class="event-title">6 staff scheduled</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">3</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task medium" onclick="openEventDetail('task', 3)" title="Inspect Irrigation System - Medium Priority">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Irrigation Check</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">4</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">5</div>
                                <div class="calendar-events">
                                    <div class="calendar-event field-activities" onclick="openEventDetail('field', 5)" title="Winter Wheat Fertilizer Application">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Fertilizer - South Crops</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">6</div>
                            </div>

                            <div class="calendar-day weekend">
                                <div class="day-number">7</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">8</div>
                                <div class="calendar-events">
                                    <div class="calendar-event sick" onclick="openEventDetail('sick', 8)" title="Mike Wilson - Sick Day">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Mike - Sick</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">9</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">10</div>
                                <div class="calendar-events">
                                    <div class="calendar-event machinery-service" onclick="openEventDetail('machinery-service', 10)" title="Tractor #1 Service Due">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Tractor Service</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day today">
                                <div class="day-number">11</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task high" onclick="openEventDetail('task', 11)" title="Harvest Planning Meeting - High Priority">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Planning Meeting</span>
                                    </div>
                                    <div class="calendar-event rota" onclick="openEventDetail('rota', 11)" title="Staff Rota">
                                        <span class="event-icon"></span>
                                        <span class="event-title">7 staff scheduled</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">12</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task medium" onclick="openEventDetail('task', 12)" title="Check Livestock Water Supplies">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Water Check</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">13</div>
                            </div>

                            <div class="calendar-day weekend">
                                <div class="day-number">14</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day" onclick="openEventDetail('holidays', 14)" title="Sarah Johnson - Holiday (Dec 14-16)">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Sarah Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">15</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 15)">
                                        <span class="event-title">Sarah Holiday</span>
                                    </div>
                                    <div class="calendar-event machinery-mot" onclick="openEventDetail('machinery-mot', 15)" title="Land Rover MOT Due (60 days notice)">
                                        <span class="event-icon"></span>
                                        <span class="event-title">MOT Due Soon</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">16</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-end" onclick="openEventDetail('holidays', 16)">
                                        <span class="event-title">Sarah Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">17</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">18</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task high" onclick="openEventDetail('task', 18)" title="Vet Visit - Cattle Health Check">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Vet Visit</span>
                                    </div>
                                    <div class="calendar-event field-activities" onclick="openEventDetail('field', 18)" title="Soil Testing - All Fields">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Soil Testing</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">19</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">20</div>
                                <div class="calendar-events">
                                    <div class="calendar-event machinery-service" onclick="openEventDetail('machinery-service', 20)" title="Combine Harvester Annual Service">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Harvester Service</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day weekend">
                                <div class="day-number">21</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">22</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">23</div>
                                <div class="calendar-events">
                                    <div class="calendar-event task low" onclick="openEventDetail('task', 23)" title="Order Supplies for Q1">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Order Supplies</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">24</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">25</div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">26</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day" onclick="openEventDetail('holidays', 26)" title="John Smith - Holiday (Dec 26-Jan 2)">
                                        <span class="event-icon"></span>
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">27</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 27)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day weekend">
                                <div class="day-number">28</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 28)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">29</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 29)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">30</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 30)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>

                            <div class="calendar-day">
                                <div class="day-number">31</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 31)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                    <div class="calendar-event task medium" onclick="openEventDetail('task', 31)" title="Year-End Equipment Inventory">
                                        <span class="event-icon"></span>
                                        <span class="event-title">Inventory</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Next Month Days -->
                            <div class="calendar-day other-month">
                                <div class="day-number">1</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-continue" onclick="openEventDetail('holidays', 1)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">2</div>
                                <div class="calendar-events">
                                    <div class="calendar-event holidays multi-day-end" onclick="openEventDetail('holidays', 2)">
                                        <span class="event-title">John Holiday</span>
                                    </div>
                                </div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">3</div>
                            </div>
                            <div class="calendar-day other-month">
                                <div class="day-number">4</div>
                            </div>
                        </div>
                    </div>

                    <!-- Week View (hidden by default) -->
                    <div class="calendar-week-view" id="calendarWeekView" style="display: none;">
                        <p style="text-align: center; padding: 40px; color: var(--text-light);">
                            Week view would show hourly schedule for 7 days
                        </p>
                    </div>

                    <!-- Day View (hidden by default) -->
                    <div class="calendar-day-view" id="calendarDayView" style="display: none;">
                        <p style="text-align: center; padding: 40px; color: var(--text-light);">
                            Day view would show hourly schedule with staff rota details
                        </p>
                    </div>

                    <!-- Agenda View (hidden by default) -->
                    <div class="calendar-agenda-view" id="calendarAgendaView" style="display: none;">
                        <div class="agenda-list">
                            <div class="agenda-section">
                                <h3 class="agenda-date">Today - December 11, 2025</h3>
                                <div class="agenda-event task high">
                                    <span class="event-time">09:00</span>
                                    <div class="event-details">
                                        <div class="event-title">Harvest Planning Meeting</div>
                                        <div class="event-meta">High Priority  Assigned to: Team</div>
                                    </div>
                                </div>
                                <div class="agenda-event rota">
                                    <span class="event-time">All Day</span>
                                    <div class="event-details">
                                        <div class="event-title">7 Staff Scheduled</div>
                                        <div class="event-meta">John, Sarah, Mike, Tom, Emma, Lisa, David</div>
                                    </div>
                                </div>
                            </div>

                            <div class="agenda-section">
                                <h3 class="agenda-date">Tomorrow - December 12, 2025</h3>
                                <div class="agenda-event task medium">
                                    <span class="event-time">10:00</span>
                                    <div class="event-details">
                                        <div class="event-title">Check Livestock Water Supplies</div>
                                        <div class="event-meta">Medium Priority  Assigned to: Mike Wilson</div>
                                    </div>
                                </div>
                            </div>

                            <div class="agenda-section">
                                <h3 class="agenda-date">This Week</h3>
                                <div class="agenda-event holidays">
                                    <span class="event-time">Dec 14-16</span>
                                    <div class="event-details">
                                        <div class="event-title">Sarah Johnson - Holiday</div>
                                        <div class="event-meta">3 days</div>
                                    </div>
                                </div>
                                <div class="agenda-event machinery-mot">
                                    <span class="event-time">Dec 15</span>
                                    <div class="event-details">
                                        <div class="event-title">Land Rover MOT Due</div>
                                        <div class="event-meta">60 days advance notice  Book appointment</div>
                                    </div>
                                </div>
                                <div class="agenda-event task high">
                                    <span class="event-time">Dec 18</span>
                                    <div class="event-details">
                                        <div class="event-title">Vet Visit - Cattle Health Check</div>
                                        <div class="event-meta">High Priority  North Pasture</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Field Detail Tab View -->
                <div class="field-detail-view" id="fieldDetailView">
                    <div class="field-detail-header">
                        <div class="field-detail-title-section">
                            <button class="back-to-map-btn" onclick="closeFieldTab()"> Back</button>
                            <div>
                                <div class="field-detail-title" id="tabFieldName">North Pasture</div>
                                <div class="field-detail-subtitle" id="tabFieldType">Pasture  45 acres</div>
                            </div>
                        </div>
                        <div class="field-detail-actions">
                            <button class="field-action-btn" onclick="alert('Add Note - would open note editor')">
                                 Add Note
                            </button>
                            <button class="field-action-btn" onclick="alert('View History - would show full timeline')">
                                 View History
                            </button>
                            <button class="field-action-btn primary" onclick="alert('Change Usage - would open usage editor')">
                                 Change Usage
                            </button>
                        </div>
                    </div>
                    <div class="field-detail-content">
                        <div class="field-detail-grid">
                            <div class="field-detail-card">
                                <h3>Field Information</h3>
                                <div class="field-info-grid" id="tabFieldInfo">
                                    <div class="info-item">
                                        <div class="info-label">Grazing Area</div>
                                        <div class="info-value">45 acres</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Field Health</div>
                                        <div class="info-value good">Good</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Livestock</div>
                                        <div class="info-value">Main Cattle Herd A</div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-label">Crop</div>
                                        <div class="info-value">Grass - Perennial Ryegrass</div>
                                    </div>
                                </div>
                            </div>
                            <div class="field-detail-card">
                                <h3>Quick Stats</h3>
                                <div style="display: flex; flex-direction: column; gap: 16px;">
                                    <div>
                                        <div class="info-label">This Month Revenue</div>
                                        <div class="info-value" style="color: #16a34a;">12,450</div>
                                    </div>
                                    <div>
                                        <div class="info-label">This Month Costs</div>
                                        <div class="info-value">5,230</div>
                                    </div>
                                    <div>
                                        <div class="info-label">Profit Margin</div>
                                        <div class="info-value" style="color: #16a34a;">58%</div>
                                    </div>
                                    <div>
                                        <div class="info-label">Status</div>
                                        <div class="status-badge active" style="margin: 0;">Active</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field-detail-card">
                            <h3> Active Tasks</h3>
                            <div class="task-list" id="tabTaskList">
                                <div class="task-item high">
                                    <div class="task-info">
                                        <div class="task-name">Water trough maintenance</div>
                                        <div class="task-meta"> Dec 20  high priority</div>
                                    </div>
                                    <div class="task-priority high">high</div>
                                </div>
                                <div class="task-item medium">
                                    <div class="task-info">
                                        <div class="task-name">Fence inspection</div>
                                        <div class="task-meta"> Dec 22  medium priority</div>
                                    </div>
                                    <div class="task-priority medium">medium</div>
                                </div>
                            </div>
                        </div>

                        <div class="field-detail-card">
                            <h3> Recent Activity</h3>
                            <div class="history-list" id="tabHistoryList">
                                <div class="history-item">
                                    <div class="history-title">Livestock rotation completed</div>
                                    <div class="history-meta">Nov 28  John Smith</div>
                                </div>
                                <div class="history-item">
                                    <div class="history-title">Fertilizer applied</div>
                                    <div class="history-meta">Nov 15  Mary Johnson</div>
                                </div>
                                <div class="history-item">
                                    <div class="history-title">Soil test conducted</div>
                                    <div class="history-meta">Nov 10  John Smith</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Management View -->
                <div class="task-view">
                    <div class="task-header">
                        <h1>Task Management</h1>
                        <p>Organize and track tasks across your estate</p>
                    </div>
                    <div class="kanban-board">
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">
                                    <span class="column-indicator todo"></span>
                                    To Do
                                </div>
                                <span class="column-count">2</span>
                            </div>
                            <div class="column-tasks" id="todo-column">
                                <div class="task-card high-priority" draggable="true" data-task-id="task-1" onclick="openTaskModal('task-1')">
                                    <div class="task-card-title">Rotate livestock</div>
                                    <div class="task-card-desc">Move cattle to fresh grazing area</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>John Smith</span>
                                        </div>
                                        <div class="task-priority high">High Priority</div>
                                    </div>
                                    <div class="task-location"> North Pasture</div>
                                    <div class="task-date"> 02/12/2025</div>
                                </div>
                                <div class="task-card medium-priority" draggable="true" data-task-id="task-2" onclick="openTaskModal('task-2')">
                                    <div class="task-card-title">Irrigation system check</div>
                                    <div class="task-card-desc">Inspect and test all irrigation lines</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>Mike Davis</span>
                                        </div>
                                        <div class="task-priority medium">Medium Priority</div>
                                    </div>
                                    <div class="task-location"> South Crops</div>
                                    <div class="task-date"> 05/12/2025</div>
                                </div>
                            </div>
                        </div>

                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">
                                    <span class="column-indicator progress"></span>
                                    In Progress
                                </div>
                                <span class="column-count">3</span>
                            </div>
                            <div class="column-tasks" id="progress-column">
                                <div class="task-card high-priority" draggable="true" data-task-id="task-3" onclick="openTaskModal('task-3')">
                                    <div class="task-card-title">Check fence perimeter</div>
                                    <div class="task-card-desc">Inspect and repair any damaged sections</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>Sarah Johnson</span>
                                        </div>
                                        <div class="task-priority high">High Priority</div>
                                    </div>
                                    <div class="task-location"> North Pasture</div>
                                    <div class="task-date"> 05/12/2025</div>
                                </div>
                                <div class="task-card medium-priority" draggable="true" data-task-id="task-4" onclick="openTaskModal('task-4')">
                                    <div class="task-card-title">Pruning maintenance</div>
                                    <div class="task-card-desc">Continue pruning apple trees</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>Field Team</span>
                                        </div>
                                        <div class="task-priority medium">Medium Priority</div>
                                    </div>
                                    <div class="task-location"> West Orchard</div>
                                    <div class="task-date"> 08/12/2025</div>
                                </div>
                                <div class="task-card medium-priority" draggable="true" data-task-id="task-5" onclick="openTaskModal('task-5')">
                                    <div class="task-card-title">Fertilizer application</div>
                                    <div class="task-card-desc">Waiting for soil test results</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>David Wilson</span>
                                        </div>
                                        <div class="task-priority medium">Medium Priority</div>
                                    </div>
                                    <div class="task-location"> South Crops</div>
                                    <div class="task-date"> 15/12/2025</div>
                                </div>
                            </div>
                        </div>

                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">
                                    <span class="column-indicator done"></span>
                                    Done
                                </div>
                                <span class="column-count">3</span>
                            </div>
                            <div class="column-tasks" id="done-column">
                                <div class="task-card" draggable="true" data-task-id="task-6" onclick="openTaskModal('task-6')">
                                    <div class="task-card-title">Spray weeds in access roads</div>
                                    <div class="task-card-desc">Spray herbicide on access roads</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>John Smith</span>
                                        </div>
                                    </div>
                                    <div class="task-location"> Multiple Fields</div>
                                    <div class="task-date"> 12/12/2025</div>
                                </div>
                                <div class="task-card" draggable="true">
                                    <div class="task-card-title">Livestock rotation completed</div>
                                    <div class="task-card-desc">Moved Main Cattle Herd A</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>John Smith</span>
                                        </div>
                                    </div>
                                    <div class="task-location"> North Pasture</div>
                                    <div class="task-date"> 28/11/2025</div>
                                </div>
                                <div class="task-card" draggable="true">
                                    <div class="task-card-title">Soil test conducted</div>
                                    <div class="task-card-desc">Samples sent to lab</div>
                                    <div class="task-card-footer">
                                        <div class="task-assignee">
                                            <span class="assignee-icon"></span>
                                            <span>John Smith</span>
                                        </div>
                                    </div>
                                    <div class="task-location"> North Pasture</div>
                                    <div class="task-date"> 10/11/2025</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Staff View -->
                <div class="staff-view">
                    <div class="staff-header">
                        <div>
                            <h1>Staff & Labour Management</h1>
                            <p>Manage your team, track leave, and monitor labour costs</p>
                        </div>
                        <button class="add-task-btn" onclick="openAddStaffModal()">
                            + Add Staff Member
                        </button>
                    </div>

                    <div class="staff-summary-cards">
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Total Staff</div>
                                <div class="metric-value">12</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Monthly Wage Bill</div>
                                <div class="metric-value">38,200</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">On Leave Today</div>
                                <div class="metric-value">2</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Upcoming Leave</div>
                                <div class="metric-value">5 (next 7 days)</div>
                            </div>
                        </div>
                    </div>

                    <div class="staff-filters">
                        <button class="filter-btn active" onclick="filterStaff('all')">All Staff (12)</button>
                        <button class="filter-btn" onclick="filterStaff('active')">Active (10)</button>
                        <button class="filter-btn" onclick="filterStaff('holiday')">On Holiday (2)</button>
                        <button class="filter-btn" onclick="filterStaff('sick')">Sick Today (0)</button>
                    </div>

                    <div class="staff-actions-bar">
                        <button class="action-btn" onclick="viewStaffRota()">
                             View Rota
                        </button>
                        <button class="action-btn" onclick="alert('Export Staff List - Would download Excel/CSV')">
                             Export List
                        </button>
                    </div>

                    <div class="staff-grid" id="staffGrid">
                        <!-- Staff cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Machinery View -->
                <div class="machinery-view">
                    <div class="machinery-header">
                        <div>
                            <h1>Machinery & Equipment</h1>
                            <p>Manage equipment, track service schedules, and monitor costs</p>
                        </div>
                        <button class="add-task-btn" onclick="openAddMachineryModal()">
                            + Add Equipment
                        </button>
                    </div>

                    <div class="machinery-summary-cards">
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Total Equipment</div>
                                <div class="metric-value">23</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Total Value</div>
                                <div class="metric-value">385,000</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Service Due This Month</div>
                                <div class="metric-value">3</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"></div>
                            <div>
                                <div class="metric-label">Monthly Equipment Costs</div>
                                <div class="metric-value">6,450</div>
                            </div>
                        </div>
                    </div>

                    <div class="machinery-tabs">
                        <button class="machinery-tab active" onclick="filterMachinery('all')">All Equipment (23)</button>
                        <button class="machinery-tab" onclick="filterMachinery('tractors')">Tractors (5)</button>
                        <button class="machinery-tab" onclick="filterMachinery('mowers')">Mowers (3)</button>
                        <button class="machinery-tab" onclick="filterMachinery('seeders')">Seeders (2)</button>
                        <button class="machinery-tab" onclick="filterMachinery('vehicles')">Vehicles (4)</button>
                        <button class="machinery-tab" onclick="filterMachinery('other')">Other (9)</button>
                    </div>

                    <div class="machinery-actions-bar">
                        <button class="action-btn" onclick="viewServiceSchedule()">
                             Service Schedule
                        </button>
                        <button class="action-btn" onclick="alert('Export Inventory - Would download Excel/CSV')">
                             Export Inventory
                        </button>
                    </div>

                    <div class="machinery-grid" id="machineryGrid">
                        <!-- Machinery cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Operations View -->
                <div class="ops-view">
                    <div class="ops-header">
                        <h1>Operational Management</h1>
                        <p>Track costs, revenues, and profitability across your estate</p>
                    </div>

                    <!-- Summary Metrics -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Total Revenue</div>
                            <div class="metric-value">187,450</div>
                            <div class="metric-change positive">
                                 12.5% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Total Costs</div>
                            <div class="metric-value">94,320</div>
                            <div class="metric-change negative">
                                 3.2% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Net Profit</div>
                            <div class="metric-value">93,130</div>
                            <div class="metric-change positive">
                                 21.8% vs last month
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Profit Margin</div>
                            <div class="metric-value">49.7%</div>
                            <div class="metric-change positive">
                                 4.1% vs last month
                            </div>
                        </div>
                    </div>

                    <!-- Primary Categories -->
                    <div class="ops-section">
                        <h2 class="ops-section-title">Primary Categories</h2>
                        <div class="ops-category-grid primary">
                            <div class="ops-category-card primary" onclick="openCategoryDetail('staff')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Staff & Labour</div>
                                    <div class="ops-category-amount cost">38,200</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change negative">+2.1% vs last month</div>
                                    <div class="ops-category-stats">12 staff members</div>
                                </div>
                            </div>
                            <div class="ops-category-card primary" onclick="openCategoryDetail('machinery')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Machinery & Equipment</div>
                                    <div class="ops-category-amount cost">6,450</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change negative">+1.8% vs last month</div>
                                    <div class="ops-category-stats">23 machines</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Categories (Costs) -->
                    <div class="ops-section">
                        <h2 class="ops-section-title">Operating Costs</h2>
                        <div class="ops-category-grid secondary">
                            <div class="ops-category-card secondary" onclick="openCategoryDetail('feed')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Feed & Supplies</div>
                                    <div class="ops-category-amount cost">20,100</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change positive">-3.2% vs last month</div>
                                    <div class="ops-category-stats">4 suppliers</div>
                                </div>
                            </div>
                            <div class="ops-category-card secondary" onclick="openCategoryDetail('veterinary')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Veterinary Services</div>
                                    <div class="ops-category-amount cost">4,850</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change negative">+12.5% vs last month</div>
                                    <div class="ops-category-stats">8 treatments this month</div>
                                </div>
                            </div>
                            <div class="ops-category-card secondary" onclick="openCategoryDetail('maintenance')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Property Maintenance</div>
                                    <div class="ops-category-amount cost">8,200</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change negative">+5.4% vs last month</div>
                                    <div class="ops-category-stats">6 active projects</div>
                                </div>
                            </div>
                            <div class="ops-category-card secondary" onclick="openCategoryDetail('crops-seeds')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Crops & Seeds</div>
                                    <div class="ops-category-amount cost">16,520</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change positive">-8.1% vs last month</div>
                                    <div class="ops-category-stats">85 hectares planted</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Categories -->
                    <div class="ops-section">
                        <h2 class="ops-section-title">Revenue Streams</h2>
                        <div class="ops-category-grid revenue">
                            <div class="ops-category-card revenue" onclick="openCategoryDetail('livestock-sales')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Livestock Sales</div>
                                    <div class="ops-category-amount revenue">85,400</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change positive">+18.2% vs last month</div>
                                    <div class="ops-category-stats">42 head sold</div>
                                </div>
                            </div>
                            <div class="ops-category-card revenue" onclick="openCategoryDetail('crop-sales')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Crop Sales</div>
                                    <div class="ops-category-amount revenue">76,200</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change positive">+9.5% vs last month</div>
                                    <div class="ops-category-stats">120 tons sold</div>
                                </div>
                            </div>
                            <div class="ops-category-card revenue" onclick="openCategoryDetail('other-income')">
                                <div class="ops-category-icon"></div>
                                <div class="ops-category-info">
                                    <div class="ops-category-name">Other Income</div>
                                    <div class="ops-category-amount revenue">25,850</div>
                                    <div class="ops-category-subtitle">per month</div>
                                    <div class="ops-category-change positive">+15.3% vs last month</div>
                                    <div class="ops-category-stats">Rentals, grants, misc</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Field Detail Modal -->
    <div class="modal-overlay" id="fieldModal">
        <div class="field-modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title" id="modalFieldName">North Pasture</div>
                    <div class="modal-subtitle" id="modalFieldType">Pasture</div>
                </div>
                <button class="close-modal" onclick="closeFieldModal()"></button>
            </div>
            <div class="modal-body">
                <div class="status-badge active">Active</div>

                <div class="field-info-grid">
                    <div class="info-item">
                        <div class="info-label">Grazing Area</div>
                        <div class="info-value">45 acres</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Field Health</div>
                        <div class="info-value good">Good</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Livestock</div>
                        <div class="info-value">Main Cattle Herd A</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Crop</div>
                        <div class="info-value">Grass - Perennial Ryegrass</div>
                    </div>
                </div>

                <button class="expand-field-btn" onclick="expandFieldToTab()">
                     Open Full Details
                </button>

                <div class="modal-actions">
                    <button class="action-btn" onclick="alert('Add Note - Quick note entry with auto-date')">
                         Add Note
                    </button>
                    <button class="action-btn" onclick="alert('Change Usage - Would open usage type selector')">
                         Change Usage
                    </button>
                    <button class="action-btn" onclick="alert('View Full History - Would show complete field timeline')">
                         Full History
                    </button>
                    <button class="action-btn" onclick="alert('Create Paddock - Would enable paddock drawing mode')">
                         Create Paddock
                    </button>
                </div>

                <div class="section-title"> Live Tasks</div>
                <div class="task-list">
                    <div class="task-item high">
                        <div class="task-info">
                            <div class="task-name">Water trough maintenance</div>
                            <div class="task-meta"> Dec 20  high priority</div>
                        </div>
                        <div class="task-priority high">high</div>
                    </div>
                    <div class="task-item medium">
                        <div class="task-info">
                            <div class="task-name">Fence inspection</div>
                            <div class="task-meta"> Dec 22  medium priority</div>
                        </div>
                        <div class="task-priority medium">medium</div>
                    </div>
                </div>

                <div class="section-title"> Recent History</div>
                <div class="history-list">
                    <div class="history-item">
                        <div class="history-title">Livestock rotation completed</div>
                        <div class="history-meta">Nov 28  John Smith</div>
                    </div>
                    <div class="history-item">
                        <div class="history-title">Fertilizer applied</div>
                        <div class="history-meta">Nov 15  Mary Johnson</div>
                    </div>
                    <div class="history-item">
                        <div class="history-title">Soil test conducted</div>
                        <div class="history-meta">Nov 10  John Smith</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div class="modal-overlay" id="taskModal">
        <div class="task-modal">
            <div class="task-modal-header">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <div class="task-modal-title" id="taskModalTitle">Rotate livestock</div>
                        <div class="task-modal-meta">
                            <div class="task-meta-item">
                                <span></span>
                                <span id="taskModalLocation">North Pasture</span>
                            </div>
                            <div class="task-meta-item">
                                <span></span>
                                <span id="taskModalDate">02/12/2025</span>
                            </div>
                            <div class="task-meta-item">
                                <span id="taskModalPriorityBadge" class="task-priority high">High Priority</span>
                            </div>
                        </div>
                    </div>
                    <button class="close-modal" onclick="closeTaskModal()"></button>
                </div>
            </div>
            
            <div class="task-modal-body">
                <div class="task-section">
                    <div class="task-section-title"> Description</div>
                    <div class="task-description" id="taskModalDescription">
                        Move cattle to fresh grazing area
                    </div>
                </div>

                <div class="task-section">
                    <div class="task-section-title"> Assigned To</div>
                    <div class="task-assignee-card">
                        <div class="assignee-avatar" id="taskModalAvatar">JS</div>
                        <div class="assignee-info">
                            <h4 id="taskModalAssignee">John Smith</h4>
                            <p>Farm Manager</p>
                        </div>
                    </div>
                </div>

                <div class="task-section">
                    <div class="task-section-title"> Status</div>
                    <div class="task-status-selector">
                        <div class="status-option" onclick="selectTaskStatus(this, 'todo')">
                            To Do
                        </div>
                        <div class="status-option" onclick="selectTaskStatus(this, 'progress')">
                            In Progress
                        </div>
                        <div class="status-option" onclick="selectTaskStatus(this, 'done')">
                            Done
                        </div>
                    </div>
                </div>

                <div class="task-section">
                    <div class="task-section-title"> Photos / Proof of Work</div>
                    <div class="photo-upload-area" onclick="alert('Photo upload would open file picker')">
                        <div class="photo-upload-icon"></div>
                        <div class="photo-upload-text">Click to upload photos</div>
                    </div>
                </div>

                <div class="task-section">
                    <div class="task-section-title"> Notes & Comments</div>
                    <textarea class="task-notes-area" placeholder="Add notes, updates, or comments about this task..."></textarea>
                </div>
            </div>

            <div class="task-modal-actions">
                <button class="task-modal-btn" onclick="closeTaskModal()">Cancel</button>
                <button class="task-modal-btn danger" onclick="deleteTask()">Delete Task</button>
                <button class="task-modal-btn primary" onclick="saveTask()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal-overlay" id="addTaskModal">
        <div class="add-task-modal">
            <div class="modal-header">
                <div>
                    <div class="modal-title">Create New Task</div>
                    <div class="modal-subtitle">Add a new task to your estate</div>
                </div>
                <button class="close-modal" onclick="closeAddTaskModal()"></button>
            </div>
            
            <div class="modal-body">
                <form id="addTaskForm" onsubmit="submitNewTask(event)">
                    <div class="form-group">
                        <label class="form-label required">Task Title</label>
                        <input type="text" class="form-input" placeholder="e.g. Check irrigation system" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Description</label>
                        <textarea class="form-textarea" placeholder="Describe what needs to be done..." required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label required">Location</label>
                            <select class="form-select" required>
                                <option value="">Select a field...</option>
                                <option value="north-pasture">North Pasture</option>
                                <option value="south-crops">South Crops</option>
                                <option value="west-orchard">West Orchard</option>
                                <option value="east-meadow">East Meadow</option>
                                <option value="multiple">Multiple Fields</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">Due Date</label>
                            <input type="date" class="form-input" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Assign To</label>
                        <select class="form-select" required>
                            <option value="">Select team member...</option>
                            <option value="john-smith">John Smith</option>
                            <option value="sarah-johnson">Sarah Johnson</option>
                            <option value="mike-davis">Mike Davis</option>
                            <option value="david-wilson">David Wilson</option>
                            <option value="mary-johnson">Mary Johnson</option>
                            <option value="field-team">Field Team</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Priority</label>
                        <div class="priority-options">
                            <div class="priority-option high" onclick="selectNewTaskPriority(this, 'high')">
                                High Priority
                            </div>
                            <div class="priority-option medium" onclick="selectNewTaskPriority(this, 'medium')">
                                Medium Priority
                            </div>
                            <div class="priority-option low" onclick="selectNewTaskPriority(this, 'low')">
                                Low Priority
                            </div>
                        </div>
                        <input type="hidden" id="taskPriority" name="priority" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Additional Notes (Optional)</label>
                        <textarea class="form-textarea" placeholder="Any additional information..."></textarea>
                    </div>
                </form>
            </div>

            <div class="task-modal-actions">
                <button class="task-modal-btn" onclick="closeAddTaskModal()">Cancel</button>
                <button class="task-modal-btn primary" onclick="submitNewTask(event)">Create Task</button>
            </div>
        </div>
    </div>

    <!-- Staff Detail Modal -->
    <div class="modal-overlay" id="staffDetailModal">
        <div class="staff-detail-modal">
            <div class="staff-detail-header">
                <div class="staff-detail-profile">
                    <div class="staff-detail-avatar" id="staffDetailAvatar">JS</div>
                    <div class="staff-detail-info">
                        <h2 id="staffDetailName">John Smith</h2>
                        <div class="staff-role" id="staffDetailRole">Farm Manager</div>
                        <span class="staff-status working" id="staffDetailStatus">Working Today</span>
                    </div>
                </div>
                <button class="close-modal" onclick="closeStaffDetail()"></button>
            </div>

            <div class="staff-detail-tabs">
                <button class="staff-tab active" onclick="switchStaffTab('personal')">Personal Info</button>
                <button class="staff-tab" onclick="switchStaffTab('employment')">Employment</button>
                <button class="staff-tab" onclick="switchStaffTab('leave')">Leave Management</button>
                <button class="staff-tab" onclick="switchStaffTab('documents')">Documents</button>
                <button class="staff-tab" onclick="switchStaffTab('notes')">Notes</button>
            </div>

            <div class="staff-detail-content">
                <!-- Personal Info Tab -->
                <div class="staff-tab-content active" id="staffPersonalTab">
                    <div class="staff-info-grid">
                        <div class="staff-info-item">
                            <div class="staff-info-label">Full Name</div>
                            <div class="staff-info-value">John Smith</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Date of Birth</div>
                            <div class="staff-info-value">15 March 1985 (39 years)</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Gender</div>
                            <div class="staff-info-value">Male</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Phone</div>
                            <div class="staff-info-value">07700 900123</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Email</div>
                            <div class="staff-info-value"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="93f9fcfbfdbde0fefae7fbd3e0fcfafff2e1f8bef7f6fefcbdf5f2e1fe">[email&#160;protected]</a></div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Address</div>
                            <div class="staff-info-value">Estate Cottage, Main Farm</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Accommodation</div>
                            <div class="staff-info-value"> Live In</div>
                        </div>
                    </div>

                    <div class="staff-section">
                        <div class="staff-section-title">Emergency Contact</div>
                        <div class="staff-info-grid">
                            <div class="staff-info-item">
                                <div class="staff-info-label">Name</div>
                                <div class="staff-info-value">Sarah Smith</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Relationship</div>
                                <div class="staff-info-value">Spouse</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Phone</div>
                                <div class="staff-info-value">07700 900124</div>
                            </div>
                        </div>
                    </div>

                    <div class="staff-important-note">
                        <div class="staff-important-note-title"> Important Medical Information</div>
                        <div class="staff-important-note-text">Allergic to bee stings - EpiPen in first aid kit</div>
                    </div>
                </div>

                <!-- Employment Tab -->
                <div class="staff-tab-content" id="staffEmploymentTab">
                    <div class="staff-info-grid">
                        <div class="staff-info-item">
                            <div class="staff-info-label">Role / Position</div>
                            <div class="staff-info-value">Farm Manager</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Start Date</div>
                            <div class="staff-info-value">1 April 2018 (6.8 years)</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Contract Type</div>
                            <div class="staff-info-value">Full-time Permanent</div>
                        </div>
                        <div class="staff-info-item">
                            <div class="staff-info-label">Hours per Week</div>
                            <div class="staff-info-value">40 hours</div>
                        </div>
                    </div>

                    <div class="staff-section">
                        <div class="staff-section-title">Salary Information</div>
                        <div class="staff-info-grid">
                            <div class="staff-info-item">
                                <div class="staff-info-label">Annual Salary (Gross)</div>
                                <div class="staff-info-value">35,000</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Monthly Gross</div>
                                <div class="staff-info-value">2,917</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Monthly Take-Home</div>
                                <div class="staff-info-value">2,315</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Tax Code</div>
                                <div class="staff-info-value">1257L</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">National Insurance</div>
                                <div class="staff-info-value">QQ 12 34 56 C</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Pension Contribution</div>
                                <div class="staff-info-value">5% (175/month)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Leave Management Tab -->
                <div class="staff-tab-content" id="staffLeaveTab">
                    <div class="staff-leave-summary">
                        <div class="staff-leave-card">
                            <div class="staff-leave-number">28</div>
                            <div class="staff-leave-label">Annual Allowance</div>
                        </div>
                        <div class="staff-leave-card">
                            <div class="staff-leave-number">14</div>
                            <div class="staff-leave-label">Used This Year</div>
                        </div>
                        <div class="staff-leave-card">
                            <div class="staff-leave-number">14</div>
                            <div class="staff-leave-label">Remaining</div>
                        </div>
                        <div class="staff-leave-card">
                            <div class="staff-leave-number">1 Apr</div>
                            <div class="staff-leave-label">Renewal Date</div>
                        </div>
                    </div>

                    <div class="staff-section">
                        <div class="staff-section-title">Upcoming Holidays</div>
                        <div style="padding: 16px; background: var(--bg-main); border-radius: 8px; text-align: center; color: var(--text-light);">
                            Calendar view would show booked holidays here
                        </div>
                    </div>

                    <div class="staff-section">
                        <div class="staff-section-title">Sick Leave Tracking</div>
                        <div class="staff-info-grid">
                            <div class="staff-info-item">
                                <div class="staff-info-label">Sick Days This Month</div>
                                <div class="staff-info-value">0 days</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Sick Days This Year</div>
                                <div class="staff-info-value">3 days</div>
                            </div>
                            <div class="staff-info-item">
                                <div class="staff-info-label">Last Sick Day</div>
                                <div class="staff-info-value">15 September 2025</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documents Tab -->
                <div class="staff-tab-content" id="staffDocumentsTab">
                    <div class="staff-documents-list">
                        <div class="staff-document-item">
                            <div>
                                <div class="staff-document-name"> Employment Contract</div>
                                <div style="font-size: 12px; color: var(--text-light);">Uploaded: 1 April 2018</div>
                            </div>
                            <button class="action-btn" onclick="alert('Would open document')">View</button>
                        </div>
                        <div class="staff-document-item">
                            <div>
                                <div class="staff-document-name"> P45 - Previous Employment</div>
                                <div style="font-size: 12px; color: var(--text-light);">Uploaded: 1 April 2018</div>
                            </div>
                            <button class="action-btn" onclick="alert('Would open document')">View</button>
                        </div>
                        <div class="staff-document-item">
                            <div>
                                <div class="staff-document-name"> Right to Work Documents</div>
                                <div style="font-size: 12px; color: var(--text-light);">Uploaded: 1 April 2018</div>
                            </div>
                            <button class="action-btn" onclick="alert('Would open document')">View</button>
                        </div>
                        <div class="staff-document-item">
                            <div>
                                <div class="staff-document-name"> Performance Review - 2024</div>
                                <div style="font-size: 12px; color: var(--text-light);">Uploaded: 15 April 2024</div>
                            </div>
                            <button class="action-btn" onclick="alert('Would open document')">View</button>
                        </div>
                    </div>
                    <button class="add-task-btn" style="margin-top: 16px;" onclick="alert('Would open file upload dialog')">
                        + Upload Document
                    </button>
                </div>

                <!-- Notes Tab -->
                <div class="staff-tab-content" id="staffNotesTab">
                    <div class="staff-notes-list">
                        <div class="staff-note-item">
                            <div class="staff-note-header">
                                <strong>Manager: Estate Owner</strong>
                                <span class="staff-note-date">15 December 2025</span>
                            </div>
                            <div class="staff-note-text">
                                Excellent work managing the winter preparation. All machinery serviced on time and staff rota well organized for the holiday period.
                            </div>
                        </div>
                        <div class="staff-note-item">
                            <div class="staff-note-header">
                                <strong>Manager: Estate Owner</strong>
                                <span class="staff-note-date">20 October 2025</span>
                            </div>
                            <div class="staff-note-text">
                                Successfully coordinated harvest season with minimal delays. Good communication with contractors and team members.
                            </div>
                        </div>
                    </div>
                    <button class="add-task-btn" style="margin-top: 16px;" onclick="alert('Would open note entry form')">
                        + Add Note
                    </button>
                </div>
            </div>

            <div class="task-modal-actions">
                <button class="task-modal-btn" onclick="closeStaffDetail()">Close</button>
                <button class="task-modal-btn" onclick="alert('Edit Staff - Would open edit form')">Edit Details</button>
            </div>
        </div>
    </div>

    <!-- Machinery Detail Modal -->
    <div class="modal-overlay" id="machineryDetailModal">
        <div class="machinery-detail-modal">
            <div class="machinery-detail-header">
                <div class="machinery-detail-profile">
                    <div class="machinery-detail-icon" id="machineryDetailIcon"></div>
                    <div class="machinery-detail-info">
                        <h2 id="machineryDetailName">John Deere 6155R</h2>
                        <div class="machinery-model" id="machineryDetailModel">Tractor  2019</div>
                        <span class="machinery-status active" id="machineryDetailStatus"> Active</span>
                    </div>
                </div>
                <button class="close-modal" onclick="closeMachineryDetail()"></button>
            </div>

            <div class="machinery-detail-tabs">
                <button class="machinery-tab-btn active" onclick="switchMachineryTab('basic')">Basic Info</button>
                <button class="machinery-tab-btn" onclick="switchMachineryTab('specs')">Specifications</button>
                <button class="machinery-tab-btn" onclick="switchMachineryTab('service')">Service History</button>
                <button class="machinery-tab-btn" onclick="switchMachineryTab('costs')">Costs & Financials</button>
                <button class="machinery-tab-btn" onclick="switchMachineryTab('documents')">Documents</button>
            </div>

            <div class="machinery-detail-content">
                <!-- Basic Info Tab -->
                <div class="machinery-tab-content active" id="machineryBasicTab">
                    <div class="machinery-info-grid">
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Equipment Name</div>
                            <div class="machinery-info-value">John Deere 6155R</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Category</div>
                            <div class="machinery-info-value">Tractor</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Make</div>
                            <div class="machinery-info-value">John Deere</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Model</div>
                            <div class="machinery-info-value">6155R</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Year</div>
                            <div class="machinery-info-value">2019 (5 years old)</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Serial Number</div>
                            <div class="machinery-info-value">1RW6155RXKE458923</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Current Status</div>
                            <div class="machinery-info-value"> Active - In Use</div>
                        </div>
                    </div>

                    <div class="machinery-section">
                        <div class="machinery-section-title">Purchase Information</div>
                        <div class="machinery-info-grid">
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Date Purchased</div>
                                <div class="machinery-info-value">15 March 2019</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Purchase Price</div>
                                <div class="machinery-info-value">95,000</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Purchased From</div>
                                <div class="machinery-info-value">Peacock & Binnall</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Warranty Expiry</div>
                                <div class="machinery-info-value">15 March 2022 (Expired)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Specifications Tab -->
                <div class="machinery-tab-content" id="machinerySpecsTab">
                    <div class="machinery-info-grid">
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Fuel Type</div>
                            <div class="machinery-info-value">Diesel</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Number Plate</div>
                            <div class="machinery-info-value">YJ19 TRK</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">GPS Enabled</div>
                            <div class="machinery-info-value"> Yes</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Front Loader</div>
                            <div class="machinery-info-value"> Yes - JD 643R</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Engine Hours</div>
                            <div class="machinery-info-value">2,450 hours</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Horsepower</div>
                            <div class="machinery-info-value">155 HP</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Tyre Size - Front</div>
                            <div class="machinery-info-value">480/70 R28</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Tyre Size - Rear</div>
                            <div class="machinery-info-value">580/70 R38</div>
                        </div>
                        <div class="machinery-info-item">
                            <div class="machinery-info-label">Weight</div>
                            <div class="machinery-info-value">6,300 kg</div>
                        </div>
                    </div>
                </div>

                <!-- Service History Tab -->
                <div class="machinery-tab-content" id="machineryServiceTab">
                    <div class="service-schedule-box">
                        <div class="machinery-section-title">Service Schedule Settings</div>
                        <div class="service-interval-options">
                            <div class="service-interval-option" onclick="selectServiceInterval(this, 'annual')">
                                <div class="service-interval-checkbox"></div>
                                <div>
                                    <div style="font-weight: 600;">Annual Service</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Service every 12 months</div>
                                </div>
                            </div>
                            <div class="service-interval-option selected" onclick="selectServiceInterval(this, 'hours')">
                                <div class="service-interval-checkbox"></div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">Hour-Based Service</div>
                                    <div style="font-size: 12px; color: var(--text-light); margin-top: 4px;">
                                        Service every <input type="number" value="600" style="width: 60px; padding: 4px; border: 1px solid var(--border-color); border-radius: 4px;"> hours
                                    </div>
                                </div>
                            </div>
                            <div class="service-interval-option" onclick="selectServiceInterval(this, 'monthly')">
                                <div class="service-interval-checkbox"></div>
                                <div>
                                    <div style="font-weight: 600;">Monthly Service</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Service every month</div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 16px; background: #fef3c7; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 4px;"> Next Service Due</div>
                            <div style="font-size: 14px;">In 150 hours (approximately 3 weeks)</div>
                        </div>
                    </div>

                    <div class="machinery-section">
                        <div class="machinery-section-title">Service History</div>
                        <table class="service-history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Hours</th>
                                    <th>Type</th>
                                    <th>Cost</th>
                                    <th>Next Due</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>15 Oct 2025</td>
                                    <td>2,300</td>
                                    <td>600hr Service</td>
                                    <td>850</td>
                                    <td>2,900 hrs</td>
                                    <td><button class="action-btn" onclick="alert('View service details')">View</button></td>
                                </tr>
                                <tr>
                                    <td>20 Apr 2025</td>
                                    <td>1,700</td>
                                    <td>600hr Service</td>
                                    <td>920</td>
                                    <td>2,300 hrs</td>
                                    <td><button class="action-btn" onclick="alert('View service details')">View</button></td>
                                </tr>
                                <tr>
                                    <td>12 Oct 2024</td>
                                    <td>1,100</td>
                                    <td>600hr Service</td>
                                    <td>890</td>
                                    <td>1,700 hrs</td>
                                    <td><button class="action-btn" onclick="alert('View service details')">View</button></td>
                                </tr>
                                <tr>
                                    <td>28 Mar 2024</td>
                                    <td>500</td>
                                    <td>Annual Service</td>
                                    <td>1,200</td>
                                    <td>1,100 hrs</td>
                                    <td><button class="action-btn" onclick="alert('View service details')">View</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="add-task-btn" style="margin-top: 16px;" onclick="alert('Would open service record entry form')">
                            + Add Service Record
                        </button>
                    </div>
                </div>

                <!-- Costs & Financials Tab -->
                <div class="machinery-tab-content" id="machineryCostsTab">
                    <div class="cost-summary-cards">
                        <div class="cost-summary-card">
                            <div class="cost-summary-number">99,860</div>
                            <div class="cost-summary-label">Total Lifetime Cost</div>
                        </div>
                        <div class="cost-summary-card">
                            <div class="cost-summary-number">405</div>
                            <div class="cost-summary-label">Monthly Average</div>
                        </div>
                        <div class="cost-summary-card">
                            <div class="cost-summary-number">4,860</div>
                            <div class="cost-summary-label">Annual Cost</div>
                        </div>
                        <div class="cost-summary-card">
                            <div class="cost-summary-number">40.76</div>
                            <div class="cost-summary-label">Cost per Hour</div>
                        </div>
                    </div>

                    <div class="machinery-section">
                        <div class="machinery-section-title">Cost Breakdown</div>
                        <div class="cost-breakdown-list">
                            <div class="cost-breakdown-item">
                                <div class="cost-breakdown-info">
                                    <div class="cost-breakdown-category">Service & Maintenance</div>
                                    <div class="cost-breakdown-detail">4 services, parts & labour</div>
                                </div>
                                <div class="cost-breakdown-amount">3,860</div>
                            </div>
                            <div class="cost-breakdown-item">
                                <div class="cost-breakdown-info">
                                    <div class="cost-breakdown-category">Fuel</div>
                                    <div class="cost-breakdown-detail">Estimated 2,450 hours usage</div>
                                </div>
                                <div class="cost-breakdown-amount">4,200</div>
                            </div>
                            <div class="cost-breakdown-item">
                                <div class="cost-breakdown-info">
                                    <div class="cost-breakdown-category">Insurance</div>
                                    <div class="cost-breakdown-detail">Annual premium</div>
                                </div>
                                <div class="cost-breakdown-amount">1,800</div>
                            </div>
                        </div>
                    </div>

                    <div class="machinery-section">
                        <div class="machinery-section-title">Current Market Value</div>
                        <div class="machinery-info-grid">
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Purchase Price</div>
                                <div class="machinery-info-value">95,000</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Current Age</div>
                                <div class="machinery-info-value">5 years</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Total Hours</div>
                                <div class="machinery-info-value">2,450 hours</div>
                            </div>
                            <div class="machinery-info-item">
                                <div class="machinery-info-label">Est. Current Value</div>
                                <div class="machinery-info-value" style="color: var(--primary-green);">62,000</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documents Tab -->
                <div class="machinery-tab-content" id="machineryDocumentsTab">
                    <div class="machinery-section">
                        <div class="machinery-section-title">Serial Plate</div>
                        <img src="https://via.placeholder.com/300x200/f59e0b/ffffff?text=Serial+Plate+Photo" 
                             alt="Serial Plate" 
                             class="serial-plate-photo">
                        <button class="add-task-btn" style="margin-top: 12px;" onclick="alert(' Scan Serial Plate\n\nThis would:\n- Open device camera\n- OCR extract: Serial number, Model, Weight, Manufacturing date\n- Auto-populate fields\n- Save original photo')">
                             Scan Serial Plate
                        </button>
                    </div>

                    <div class="machinery-section">
                        <div class="machinery-section-title">Documents</div>
                        <div class="machinery-documents-list">
                            <div class="machinery-document-item">
                                <div>
                                    <div class="machinery-document-name"> Purchase Invoice</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Uploaded: 15 March 2019</div>
                                </div>
                                <button class="action-btn" onclick="alert('Would open document')">View</button>
                            </div>
                            <div class="machinery-document-item">
                                <div>
                                    <div class="machinery-document-name"> Owner's Manual</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Uploaded: 15 March 2019</div>
                                </div>
                                <button class="action-btn" onclick="alert('Would open document')">View</button>
                            </div>
                            <div class="machinery-document-item">
                                <div>
                                    <div class="machinery-document-name"> Service Manual</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Uploaded: 15 March 2019</div>
                                </div>
                                <button class="action-btn" onclick="alert('Would open document')">View</button>
                            </div>
                            <div class="machinery-document-item">
                                <div>
                                    <div class="machinery-document-name"> Insurance Certificate</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Uploaded: 1 January 2025</div>
                                </div>
                                <button class="action-btn" onclick="alert('Would open document')">View</button>
                            </div>
                        </div>
                        <button class="add-task-btn" style="margin-top: 16px;" onclick="alert('Would open file upload dialog')">
                            + Upload Document
                        </button>
                    </div>
                </div>
            </div>

            <div class="task-modal-actions">
                <button class="task-modal-btn" onclick="closeMachineryDetail()">Close</button>
                <button class="task-modal-btn" onclick="alert('Edit Equipment - Would open edit form')">Edit Details</button>
            </div>
        </div>
    </div>

    <!-- Operations Drill-Down Modal -->
    <div class="modal-overlay" id="opsDetailModal">
        <div class="ops-detail-modal">
            <div class="ops-modal-header">
                <div class="ops-modal-title-section">
                    <h2 id="opsModalTitle">Feed & Supplies</h2>
                    <div class="ops-modal-subtitle" id="opsModalSubtitle">Detailed breakdown and analytics</div>
                </div>
                <button class="close-modal" onclick="closeOpsModal()"></button>
            </div>

            <!-- Time Period Selector -->
            <div class="ops-modal-period-selector">
                <button class="period-btn active" onclick="selectOpsPeriod(this, 'month')">This Month</button>
                <button class="period-btn" onclick="selectOpsPeriod(this, 'quarter')">This Quarter</button>
                <button class="period-btn" onclick="selectOpsPeriod(this, 'year')">This Year</button>
            </div>
            
            <div class="ops-modal-body">
                <!-- Summary Cards -->
                <div class="ops-summary-cards">
                    <div class="ops-summary-card">
                        <div class="ops-summary-label" id="opsModalLabel1">Total Cost</div>
                        <div class="ops-summary-value" id="opsModalTotal">20,100</div>
                        <div class="ops-summary-change positive" id="opsModalChange">-3.2% vs last month</div>
                    </div>
                    <div class="ops-summary-card">
                        <div class="ops-summary-label">Transactions</div>
                        <div class="ops-summary-value" id="opsModalCount">24</div>
                    </div>
                    <div class="ops-summary-card">
                        <div class="ops-summary-label">% of Total Costs</div>
                        <div class="ops-summary-value" id="opsModalPercent">21.3%</div>
                    </div>
                    <div class="ops-summary-card" id="opsModalExtraCard" style="display: none;">
                        <div class="ops-summary-label" id="opsModalExtraLabel">Quick Stat</div>
                        <div class="ops-summary-value" id="opsModalExtraValue">-</div>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="ops-detail-section">
                    <h3> Trend Over Time (Last 12 Months)</h3>
                    <div class="trend-chart">
                        <canvas id="opsTrendChart" style="max-height: 200px;"></canvas>
                        <div style="text-align: center; padding: 60px 20px; color: var(--text-light); font-style: italic;">
                            Line chart showing monthly trend would be rendered here using Chart.js
                        </div>
                    </div>
                </div>

                <!-- Sub-Categories Section -->
                <div class="ops-detail-section" id="opsSubcategories">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3> Sub-Categories Breakdown</h3>
                    </div>
                    <div class="subcategory-list" id="opsSubcategoryList">
                        <!-- Sub-categories will be inserted here -->
                    </div>
                </div>

                <!-- Transactions Section -->
                <div class="ops-detail-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3> Recent Transactions</h3>
                        <button class="show-all-btn" id="opsShowAllBtn" onclick="toggleShowAllTransactions()">
                            Show All 
                        </button>
                    </div>
                    
                    <!-- Transaction Filters -->
                    <div class="transaction-filters" id="opsTransactionFilters" style="display: none;">
                        <input type="text" class="form-input" placeholder=" Search transactions..." 
                               onkeyup="filterOpsTransactions()" id="opsSearchInput">
                        <select class="form-select" onchange="filterOpsTransactions()" id="opsSubcatFilter">
                            <option value="">All Sub-Categories</option>
                        </select>
                        <select class="form-select" onchange="filterOpsTransactions()" id="opsSortBy">
                            <option value="date-desc">Date (Newest First)</option>
                            <option value="date-asc">Date (Oldest First)</option>
                            <option value="amount-desc">Amount (Highest First)</option>
                            <option value="amount-asc">Amount (Lowest First)</option>
                        </select>
                    </div>

                    <div class="transaction-list" id="opsTransactionList">
                        <!-- Transactions will be inserted here -->
                    </div>
                    
                    <div id="opsPagination" style="display: none; margin-top: 16px; text-align: center;">
                        <button class="task-modal-btn" onclick="loadMoreTransactions()">Load More</button>
                    </div>
                </div>

                <!-- Field Breakdown Section -->
                <div class="ops-detail-section" id="opsFieldBreakdown" style="display: none;">
                    <h3> Breakdown by Field</h3>
                    <div class="field-breakdown-grid" id="opsFieldGrid">
                        <!-- Field breakdown will be inserted here -->
                    </div>
                </div>

                <!-- Analytics Section (for specific categories) -->
                <div class="ops-detail-section" id="opsAnalytics" style="display: none;">
                    <h3> Analytics & Insights</h3>
                    <div id="opsAnalyticsContent">
                        <!-- Analytics content will be inserted here -->
                    </div>
                </div>
            </div>

            <div class="task-modal-actions">
                <button class="task-modal-btn" onclick="closeOpsModal()">Close</button>
                <button class="task-modal-btn" onclick="openAddTransactionForm()">+ Add Transaction</button>
                <button class="task-modal-btn" onclick="exportOpsData()"> Export</button>
                <button class="task-modal-btn primary" onclick="generateOpsReport()"> View Report</button>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <div class="notifications-title">Notifications</div>
            <div class="notifications-actions">
                <button class="notification-action-btn" onclick="markAllAsRead()">Mark all read</button>
                <button class="notification-action-btn" onclick="closeNotifications()"></button>
            </div>
        </div>

        <div class="notification-tabs">
            <button class="notification-tab active" onclick="filterNotifications('all')">All</button>
            <button class="notification-tab" onclick="filterNotifications('tasks')">Tasks</button>
            <button class="notification-tab" onclick="filterNotifications('fields')">Fields</button>
            <button class="notification-tab" onclick="filterNotifications('alerts')">Alerts</button>
        </div>

        <div class="notifications-list" id="notificationsList">
            <!-- Notifications will be inserted here -->
        </div>
    </div>

    <!-- Notification overlay to close when clicking outside -->
    <div id="notificationOverlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000;" onclick="closeNotifications()"></div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Field data
        const fieldData = {
            'North Pasture': {
                type: 'Pasture',
                area: '45 acres',
                health: 'Good',
                livestock: 'Main Cattle Herd A',
                crop: 'Grass - Perennial Ryegrass',
                revenue: '12,450',
                costs: '5,230',
                margin: '58%',
                tasks: [
                    { name: 'Water trough maintenance', date: 'Dec 20', priority: 'high' },
                    { name: 'Fence inspection', date: 'Dec 22', priority: 'medium' }
                ],
                history: [
                    { title: 'Livestock rotation completed', date: 'Nov 28', person: 'John Smith' },
                    { title: 'Fertilizer applied', date: 'Nov 15', person: 'Mary Johnson' },
                    { title: 'Soil test conducted', date: 'Nov 10', person: 'John Smith' }
                ]
            },
            'South Crops': {
                type: 'Crops',
                area: '62 acres',
                health: 'Excellent',
                livestock: 'None',
                crop: 'Winter Wheat',
                revenue: '18,900',
                costs: '6,820',
                margin: '64%',
                tasks: [
                    { name: 'Irrigation system check', date: 'Dec 5', priority: 'medium' },
                    { name: 'Fertilizer application', date: 'Dec 15', priority: 'medium' }
                ],
                history: [
                    { title: 'Planting completed', date: 'Oct 15', person: 'David Wilson' },
                    { title: 'Soil preparation', date: 'Oct 1', person: 'Field Team' }
                ]
            },
            'West Orchard': {
                type: 'Orchard',
                area: '28 acres',
                health: 'Good',
                livestock: 'None',
                crop: 'Apple Trees - Mixed Varieties',
                revenue: '8,650',
                costs: '5,020',
                margin: '42%',
                tasks: [
                    { name: 'Pruning maintenance', date: 'Dec 8', priority: 'medium' }
                ],
                history: [
                    { title: 'Harvest completed', date: 'Sep 20', person: 'Field Team' },
                    { title: 'Pest treatment', date: 'Aug 5', person: 'Sarah Johnson' }
                ]
            },
            'East Meadow': {
                type: 'Meadow',
                area: '38 acres',
                health: 'Good',
                livestock: 'Sheep Flock B',
                crop: 'Mixed Wildflower Meadow',
                revenue: '9,200',
                costs: '4,510',
                margin: '51%',
                tasks: [],
                history: [
                    { title: 'Sheep moved to field', date: 'Dec 1', person: 'John Smith' },
                    { title: 'Mowing completed', date: 'Aug 15', person: 'Mike Davis' }
                ]
            }
        };

        let currentFieldName = '';
        let currentTaskData = null;
        let previousView = 'overview'; // Track which view we came from

        // Task data structure
        const taskDatabase = {
            'task-1': {
                title: 'Rotate livestock',
                description: 'Move cattle to fresh grazing area',
                location: 'North Pasture',
                date: '02/12/2025',
                priority: 'high',
                assignee: 'John Smith',
                assigneeInitials: 'JS',
                status: 'todo'
            },
            'task-2': {
                title: 'Irrigation system check',
                description: 'Inspect and test all irrigation lines',
                location: 'South Crops',
                date: '05/12/2025',
                priority: 'medium',
                assignee: 'Mike Davis',
                assigneeInitials: 'MD',
                status: 'todo'
            },
            'task-3': {
                title: 'Check fence perimeter',
                description: 'Inspect and repair any damaged sections',
                location: 'North Pasture',
                date: '05/12/2025',
                priority: 'high',
                assignee: 'Sarah Johnson',
                assigneeInitials: 'SJ',
                status: 'progress'
            },
            'task-4': {
                title: 'Pruning maintenance',
                description: 'Continue pruning apple trees',
                location: 'West Orchard',
                date: '08/12/2025',
                priority: 'medium',
                assignee: 'Field Team',
                assigneeInitials: 'FT',
                status: 'progress'
            },
            'task-5': {
                title: 'Fertilizer application',
                description: 'Waiting for soil test results',
                location: 'South Crops',
                date: '15/12/2025',
                priority: 'medium',
                assignee: 'David Wilson',
                assigneeInitials: 'DW',
                status: 'progress'
            },
            'task-6': {
                title: 'Spray weeds in access roads',
                description: 'Spray herbicide on access roads',
                location: 'Multiple Fields',
                date: '12/12/2025',
                priority: 'low',
                assignee: 'John Smith',
                assigneeInitials: 'JS',
                status: 'done'
            }
        };

        // Expand field to full tab view
        function expandFieldToTab() {
            closeFieldModal();
            
            const data = fieldData[currentFieldName];
            if (!data) return;

            // Hide all main content views
            document.querySelector('.map-view').classList.remove('active');
            document.querySelector('.task-view').classList.remove('active');
            document.querySelector('.staff-view').classList.remove('active');
            document.querySelector('.machinery-view').classList.remove('active');
            document.querySelector('.ops-view').classList.remove('active');
            
            // Show field detail view
            document.getElementById('fieldDetailView').classList.add('active');

            // Update tab header
            document.getElementById('tabFieldName').textContent = currentFieldName;
            document.getElementById('tabFieldType').textContent = `${data.type}  ${data.area}`;

            // Update field info
            document.getElementById('tabFieldInfo').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Grazing Area</div>
                    <div class="info-value">${data.area}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Field Health</div>
                    <div class="info-value good">${data.health}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Livestock</div>
                    <div class="info-value">${data.livestock}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Crop</div>
                    <div class="info-value">${data.crop}</div>
                </div>
            `;

            // Update tasks
            const tabTaskList = document.getElementById('tabTaskList');
            if (data.tasks.length > 0) {
                tabTaskList.innerHTML = data.tasks.map(task => `
                    <div class="task-item ${task.priority}">
                        <div class="task-info">
                            <div class="task-name">${task.name}</div>
                            <div class="task-meta"> ${task.date}  ${task.priority} priority</div>
                        </div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                `).join('');
            } else {
                tabTaskList.innerHTML = '<div style="color: var(--text-light); text-align: center; padding: 20px;">No active tasks</div>';
            }

            // Update history
            document.getElementById('tabHistoryList').innerHTML = data.history.map(item => `
                <div class="history-item">
                    <div class="history-title">${item.title}</div>
                    <div class="history-meta">${item.date}  ${item.person}</div>
                </div>
            `).join('');

            // Update quick stats
            const quickStats = document.querySelector('.field-detail-card:nth-child(2)');
            if (quickStats) {
                quickStats.querySelector('.field-detail-card').innerHTML = `
                    <h3>Quick Stats</h3>
                    <div style="display: flex; flex-direction: column; gap: 16px;">
                        <div>
                            <div class="info-label">This Month Revenue</div>
                            <div class="info-value" style="color: #16a34a;">${data.revenue}</div>
                        </div>
                        <div>
                            <div class="info-label">This Month Costs</div>
                            <div class="info-value">${data.costs}</div>
                        </div>
                        <div>
                            <div class="info-label">Profit Margin</div>
                            <div class="info-value" style="color: #16a34a;">${data.margin}</div>
                        </div>
                        <div>
                            <div class="info-label">Status</div>
                            <div class="status-badge active" style="margin: 0;">Active</div>
                        </div>
                    </div>
                `;
            }
        }

        // Close field tab and return to previous view
        function closeFieldTab() {
            document.getElementById('fieldDetailView').classList.remove('active');
            
            // Return to whichever view we came from
            if (previousView === 'map') {
                document.querySelector('.map-view').classList.add('active');
            } else if (previousView === 'tasks') {
                document.querySelector('.task-view').classList.add('active');
            } else if (previousView === 'staff') {
                document.querySelector('.staff-view').classList.add('active');
            } else if (previousView === 'machinery') {
                document.querySelector('.machinery-view').classList.add('active');
            } else if (previousView === 'operations') {
                document.querySelector('.ops-view').classList.add('active');
            } else {
                // Default to map if we don't know
                document.querySelector('.map-view').classList.add('active');
            }
        }

        // Open task detail modal
        function openTaskModal(taskId) {
            const task = taskDatabase[taskId];
            if (!task) return;

            currentTaskData = task;
            const modal = document.getElementById('taskModal');

            // Update modal content
            document.getElementById('taskModalTitle').textContent = task.title;
            document.getElementById('taskModalDescription').textContent = task.description;
            document.getElementById('taskModalLocation').textContent = task.location;
            document.getElementById('taskModalDate').textContent = task.date;
            document.getElementById('taskModalAssignee').textContent = task.assignee;
            document.getElementById('taskModalAvatar').textContent = task.assigneeInitials;

            // Update priority badge
            const priorityBadge = document.getElementById('taskModalPriorityBadge');
            priorityBadge.className = `task-priority ${task.priority}`;
            priorityBadge.textContent = task.priority === 'high' ? 'High Priority' : task.priority === 'medium' ? 'Medium Priority' : 'Low Priority';

            // Set status
            document.querySelectorAll('.status-option').forEach(option => {
                option.classList.remove('selected');
            });
            const statusMap = { 'todo': 0, 'progress': 1, 'done': 2 };
            document.querySelectorAll('.status-option')[statusMap[task.status]]?.classList.add('selected');

            modal.classList.add('active');
        }

        // Close task modal
        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            currentTaskData = null;
        }

        // Select task status
        function selectTaskStatus(element, status) {
            document.querySelectorAll('.status-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            if (currentTaskData) {
                currentTaskData.status = status;
            }
        }

        // Save task changes
        function saveTask() {
            if (currentTaskData) {
                alert('Task saved successfully!\n\nIn the real app, this would:\n- Update the task in the database\n- Refresh the kanban board\n- Send notifications if needed\n- Update any linked field views');
                closeTaskModal();
            }
        }

        // Delete task
        function deleteTask() {
            if (confirm('Are you sure you want to delete this task?')) {
                alert('Task deleted!\n\nIn the real app, this would:\n- Remove the task from the database\n- Refresh the kanban board\n- Update field task counts');
                closeTaskModal();
            }
        }

        // Close modal on overlay click
        document.getElementById('taskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTaskModal();
            }
        });

        // Add Task Modal Functions
        function openAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('active');
        }

        function closeAddTaskModal() {
            document.getElementById('addTaskModal').classList.remove('active');
            document.getElementById('addTaskForm').reset();
            // Reset priority selection
            document.querySelectorAll('.priority-option').forEach(opt => {
                opt.classList.remove('selected');
            });
        }

        function selectNewTaskPriority(element, priority) {
            document.querySelectorAll('.priority-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('taskPriority').value = priority;
        }

        function submitNewTask(event) {
            if (event) event.preventDefault();
            
            // Check if priority is selected
            if (!document.getElementById('taskPriority').value) {
                alert('Please select a priority level');
                return;
            }

            alert('Task created successfully!\n\nIn the real app, this would:\n- Save the task to the database\n- Add it to the kanban board\n- Send notifications to the assignee\n- Update field task counts');
            closeAddTaskModal();
        }

        // Close add task modal on overlay click
        document.getElementById('addTaskModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAddTaskModal();
            }
        });

        // Show field detail modal
        function showFieldDetail(fieldName) {
            currentFieldName = fieldName;
            
            // Track which view we're currently in
            if (document.querySelector('.map-view').classList.contains('active')) {
                previousView = 'map';
            } else if (document.querySelector('.task-view').classList.contains('active')) {
                previousView = 'tasks';
            } else if (document.querySelector('.staff-view').classList.contains('active')) {
                previousView = 'staff';
            } else if (document.querySelector('.machinery-view').classList.contains('active')) {
                previousView = 'machinery';
            } else if (document.querySelector('.ops-view').classList.contains('active')) {
                previousView = 'operations';
            }
            
            const modal = document.getElementById('fieldModal');
            const data = fieldData[fieldName];

            if (!data) return;

            document.getElementById('modalFieldName').textContent = fieldName;
            document.getElementById('modalFieldType').textContent = data.type;

            // Update info grid
            const infoGrid = document.querySelector('.field-info-grid');
            infoGrid.innerHTML = `
                <div class="info-item">
                    <div class="info-label">Grazing Area</div>
                    <div class="info-value">${data.area}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Field Health</div>
                    <div class="info-value good">${data.health}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Livestock</div>
                    <div class="info-value">${data.livestock}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Crop</div>
                    <div class="info-value">${data.crop}</div>
                </div>
            `;

            // Update tasks
            const taskList = document.querySelector('.task-list');
            if (data.tasks.length > 0) {
                taskList.innerHTML = data.tasks.map(task => `
                    <div class="task-item ${task.priority}">
                        <div class="task-info">
                            <div class="task-name">${task.name}</div>
                            <div class="task-meta"> ${task.date}  ${task.priority} priority</div>
                        </div>
                        <div class="task-priority ${task.priority}">${task.priority}</div>
                    </div>
                `).join('');
            } else {
                taskList.innerHTML = '<div style="color: var(--text-light); text-align: center; padding: 20px;">No active tasks</div>';
            }

            // Update history
            const historyList = document.querySelector('.history-list');
            historyList.innerHTML = data.history.map(item => `
                <div class="history-item">
                    <div class="history-title">${item.title}</div>
                    <div class="history-meta">${item.date}  ${item.person}</div>
                </div>
            `).join('');

            modal.classList.add('active');
        }

        function closeFieldModal() {
            document.getElementById('fieldModal').classList.remove('active');
        }

        // Close modal on overlay click
        document.getElementById('fieldModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFieldModal();
            }
        });

        // Switch main navigation view
        // Overview View Switching (Map vs Calendar)
        function switchOverviewView(view) {
            // Update buttons
            document.querySelectorAll('.view-switch-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update views
            const mapView = document.getElementById('overviewMapView');
            const calendarView = document.getElementById('overviewCalendarView');

            if (view === 'map') {
                mapView.classList.add('active');
                calendarView.classList.remove('active');
            } else if (view === 'calendar') {
                mapView.classList.remove('active');
                calendarView.classList.add('active');
            }
        }

        // Calendar Navigation
        let currentCalendarMonth = new Date(2025, 11, 1); // December 2025

        function previousMonth() {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() - 1);
            updateCalendarDisplay();
        }

        function nextMonth() {
            currentCalendarMonth.setMonth(currentCalendarMonth.getMonth() + 1);
            updateCalendarDisplay();
        }

        function goToToday() {
            currentCalendarMonth = new Date();
            updateCalendarDisplay();
        }

        function updateCalendarDisplay() {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                          'July', 'August', 'September', 'October', 'November', 'December'];
            const periodEl = document.getElementById('calendarCurrentPeriod');
            if (periodEl) {
                periodEl.textContent = `${months[currentCalendarMonth.getMonth()]} ${currentCalendarMonth.getFullYear()}`;
            }
            // In production, would regenerate calendar grid with new events
        }

        // Calendar View Type Switching
        let currentCalendarViewType = 'month';

        function setCalendarView(viewType) {
            currentCalendarViewType = viewType;

            // Update buttons
            document.querySelectorAll('.calendar-view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all views
            document.getElementById('calendarMonthView').style.display = 'none';
            document.getElementById('calendarWeekView').style.display = 'none';
            document.getElementById('calendarDayView').style.display = 'none';
            document.getElementById('calendarAgendaView').style.display = 'none';

            // Show selected view
            switch(viewType) {
                case 'month':
                    document.getElementById('calendarMonthView').style.display = 'block';
                    break;
                case 'week':
                    document.getElementById('calendarWeekView').style.display = 'block';
                    break;
                case 'day':
                    document.getElementById('calendarDayView').style.display = 'block';
                    break;
                case 'agenda':
                    document.getElementById('calendarAgendaView').style.display = 'block';
                    break;
            }
        }

        // Calendar Filters
        let calendarFilters = {
            tasks: true,
            'machinery-service': true,
            'machinery-mot': true,
            holidays: true,
            rota: true,
            sick: true,
            'field-activities': true
        };

        function toggleCalendarFilter(filterType) {
            calendarFilters[filterType] = !calendarFilters[filterType];
            
            // Toggle visibility of events
            const eventClass = `.calendar-event.${filterType}`;
            document.querySelectorAll(eventClass).forEach(event => {
                event.style.display = calendarFilters[filterType] ? 'flex' : 'none';
            });

            // Also toggle in agenda view
            const agendaClass = `.agenda-event.${filterType}`;
            document.querySelectorAll(agendaClass).forEach(event => {
                event.style.display = calendarFilters[filterType] ? 'flex' : 'none';
            });
        }

        function filterCalendarByPerson(person) {
            // In production, would filter events by assigned person
            if (person) {
                console.log('Filtering calendar by person:', person);
            }
        }

        function filterCalendarByMachine(machine) {
            // In production, would filter machinery-related events
            if (machine) {
                console.log('Filtering calendar by machine:', machine);
            }
        }

        function filterCalendarByField(field) {
            // In production, would filter field-related events
            if (field) {
                console.log('Filtering calendar by field:', field);
            }
        }

        function filterHighPriorityOnly(checked) {
            if (checked) {
                // Hide all non-high priority tasks
                document.querySelectorAll('.calendar-event.task:not(.high)').forEach(event => {
                    event.style.display = 'none';
                });
                document.querySelectorAll('.agenda-event.task:not(.high)').forEach(event => {
                    event.style.display = 'none';
                });
            } else {
                // Show all tasks if their category filter is on
                document.querySelectorAll('.calendar-event.task').forEach(event => {
                    event.style.display = calendarFilters.tasks ? 'flex' : 'none';
                });
                document.querySelectorAll('.agenda-event.task').forEach(event => {
                    event.style.display = calendarFilters.tasks ? 'flex' : 'none';
                });
            }
        }

        // Event Detail
        function openEventDetail(eventType, eventId) {
            const eventDetails = {
                'task': {
                    1: 'Fix North Pasture Fence - High Priority\nAssigned to: John Smith\nDue: Dec 1, 2025\nStatus: In Progress',
                    3: 'Inspect Irrigation System - Medium Priority\nAssigned to: Mike Wilson\nDue: Dec 3, 2025\nStatus: Not Started',
                    11: 'Harvest Planning Meeting - High Priority\nAssigned to: Team\nTime: 9:00 AM\nLocation: Main Office',
                    12: 'Check Livestock Water Supplies - Medium Priority\nAssigned to: Mike Wilson\nDue: Dec 12, 2025',
                    18: 'Vet Visit - Cattle Health Check - High Priority\nVet: Dr. Sarah Thompson\nTime: 10:00 AM\nLocation: North Pasture',
                    23: 'Order Supplies for Q1 - Low Priority\nAssigned to: Admin\nDeadline: Dec 23, 2025',
                    31: 'Year-End Equipment Inventory - Medium Priority\nAssigned to: John Smith\nDue: Dec 31, 2025'
                },
                'machinery-service': {
                    10: 'Tractor #1 Annual Service\nMachine: John Deere 6155R\nLast Service: Dec 10, 2024\nService Interval: Annual\nEstimated Cost: 850\nBooked with: Local Dealer',
                    20: 'Combine Harvester Annual Service\nMachine: Case IH Axial-Flow 7150\nLast Service: Dec 20, 2024\nService Interval: Annual\nEstimated Cost: 1,200'
                },
                'machinery-mot': {
                    15: 'Land Rover Defender MOT Due\nVehicle: Land Rover Defender 110\nMOT Expiry: Feb 15, 2026 (60 days notice)\nLast MOT: Feb 15, 2025\nReminder: Book appointment at local garage'
                },
                'holidays': {
                    14: 'Sarah Johnson - Holiday\nDates: Dec 14-16, 2025 (3 days)\nApproved by: Manager\nCover arranged: Yes',
                    26: 'John Smith - Holiday\nDates: Dec 26, 2025 - Jan 2, 2026 (7 days)\nApproved by: Manager\nCover arranged: Yes'
                },
                'rota': {
                    2: 'Staff Rota - December 2\nScheduled:\n- John Smith (7am-3pm)\n- Sarah Johnson (7am-3pm)\n- Mike Wilson (8am-4pm)\n- Tom Brown (9am-5pm)\n- Emma Davis (7am-3pm)\n- Lisa Taylor (8am-4pm)',
                    11: 'Staff Rota - December 11\nScheduled:\n- John Smith (7am-3pm)\n- Mike Wilson (8am-4pm)\n- Tom Brown (9am-5pm)\n- Emma Davis (7am-3pm)\n- Lisa Taylor (8am-4pm)\n- David Jones (8am-4pm)\n- Claire Martin (9am-5pm)'
                },
                'sick': {
                    8: 'Mike Wilson - Sick Day\nDate: Dec 8, 2025\nReason: Flu\nCover arranged: Tom Brown covering duties'
                },
                'field': {
                    5: 'Winter Wheat Fertilizer Application\nField: South Crops (62 hectares)\nCrop: Winter Wheat\nFertilizer Type: NPK 20-10-10\nAmount: 250kg/ha\nScheduled: Dec 5, 2025\nAssigned to: Contractor',
                    18: 'Soil Testing - All Fields\nFields: All pasture and crop fields\nTests: pH, NPK levels, organic matter\nLab: AgriTest UK\nResults expected: Dec 25, 2025'
                }
            };

            const detail = eventDetails[eventType]?.[eventId] || 'Event details not found';
            alert(` Event Details\n\n${detail}\n\nIn production, this would open a detailed modal with:\n- Full event information\n- Edit/delete options\n- Related documents\n- Comments/notes\n- Drag-to-reschedule functionality`);
        }

        function openAddEventModal() {
            alert('Add New Calendar Event\n\nThis would open a form to create:\n- Tasks (with priority, assignee, field)\n- Staff holidays (with date range)\n- Machinery service reminders\n- Field activities (planting, harvest, treatments)\n- Custom events\n\nAll events automatically appear on calendar and sync with their respective modules.');
        }

        function switchView(view) {
            // Update sidebar navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Hide all content views
            document.querySelectorAll('.map-view, .task-view, .staff-view, .machinery-view, .ops-view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Show the appropriate content view
            if (view === 'overview') {
                document.querySelector('.map-view').classList.add('active');
            } else if (view === 'tasks') {
                document.querySelector('.task-view').classList.add('active');
            } else if (view === 'staff') {
                document.querySelector('.staff-view').classList.add('active');
                renderStaffGrid();
            } else if (view === 'machinery') {
                document.querySelector('.machinery-view').classList.add('active');
                renderMachineryGrid();
            } else if (view === 'operations') {
                document.querySelector('.ops-view').classList.add('active');
            }
            
            console.log('Switched to:', view);
        }

        // Switch content area view - DEPRECATED, now handled by switchView
        function switchContentView(viewId) {
            // This function is no longer used but kept for compatibility
            console.log('switchContentView called:', viewId);
        }

        // Drag and drop for kanban (desktop only)
        let draggedElement = null;

        // Only enable drag and drop on desktop
        if (window.innerWidth > 768) {
            enableDragAndDrop();
        }

        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                enableDragAndDrop();
            } else {
                disableDragAndDrop();
            }
        });

        function enableDragAndDrop() {
            document.querySelectorAll('.task-card').forEach(card => {
                card.setAttribute('draggable', 'true');
                
                card.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.style.opacity = '0.5';
                });

                card.addEventListener('dragend', function(e) {
                    this.style.opacity = '1';
                });
            });

            document.querySelectorAll('.column-tasks').forEach(column => {
                column.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(column, e.clientY);
                    if (afterElement == null) {
                        column.appendChild(draggedElement);
                    } else {
                        column.insertBefore(draggedElement, afterElement);
                    }
                });

                column.addEventListener('drop', function(e) {
                    e.preventDefault();
                    updateColumnCounts();
                });
            });
        }

        function disableDragAndDrop() {
            document.querySelectorAll('.task-card').forEach(card => {
                card.setAttribute('draggable', 'false');
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function updateColumnCounts() {
            document.querySelectorAll('.kanban-column').forEach(column => {
                const count = column.querySelectorAll('.task-card').length;
                column.querySelector('.column-count').textContent = count;
            });
        }

        // Operations Category Detail Function
        // Category detail data with full structures
        const categoryDetailData = {
            'staff': {
                title: 'Staff & Labour',
                type: 'cost',
                total: '38,200',
                change: '+2.1%',
                changeType: 'negative',
                count: '24',
                percent: '40.5%',
                subcategories: [
                    {
                        name: 'Permanent Staff Wages',
                        amount: '28,500',
                        type: 'cost',
                        details: [
                            { label: '12 Employees', value: 'Full-time & part-time' },
                            { label: 'Avg per person', value: '2,375/month' }
                        ],
                        percent: 75
                    },
                    {
                        name: 'Contractors',
                        amount: '6,400',
                        type: 'cost',
                        details: [
                            { label: '3 Active contracts', value: 'Fencing, spraying, harvesting' },
                            { label: 'Total hours', value: '85 hrs this month' }
                        ],
                        percent: 17
                    },
                    {
                        name: 'Seasonal Workers',
                        amount: '2,400',
                        type: 'cost',
                        details: [
                            { label: '2 Workers', value: 'Orchard picking' },
                            { label: 'Hourly rate', value: '12/hour' }
                        ],
                        percent: 6
                    },
                    {
                        name: 'Consultants & Professional Services',
                        amount: '900',
                        type: 'cost',
                        details: [
                            { label: 'Farm consultant', value: '1 visit this month' },
                            { label: 'Services', value: 'Crop planning advice' }
                        ],
                        percent: 2
                    }
                ],
                transactions: [
                    { title: 'Monthly Payroll', date: '01 Dec 2025', subcategory: 'Permanent Staff Wages', field: 'Estate Wide', amount: '28,500', type: 'expense' },
                    { title: 'Contractor - Fencing', date: '15 Dec 2025', subcategory: 'Contractors', field: 'North Pasture', amount: '3,200', type: 'expense' },
                    { title: 'Contractor - Spraying', date: '10 Dec 2025', subcategory: 'Contractors', field: 'South Crops', amount: '2,800', type: 'expense' },
                    { title: 'Seasonal Workers', date: '05 Dec 2025', subcategory: 'Seasonal Workers', field: 'West Orchard', amount: '2,400', type: 'expense' },
                    { title: 'Farm Consultant', date: '03 Dec 2025', subcategory: 'Consultants & Professional Services', field: 'Estate Wide', amount: '900', type: 'expense' },
                    { title: 'Contractor - Equipment Repair', date: '20 Dec 2025', subcategory: 'Contractors', field: 'Machinery Barn', amount: '400', type: 'expense' }
                ]
            },
            'machinery': {
                title: 'Machinery & Equipment',
                type: 'cost',
                total: '6,450',
                change: '+1.8%',
                changeType: 'negative',
                count: '18',
                percent: '6.8%',
                subcategories: [
                    {
                        name: 'Fuel & Diesel',
                        amount: '2,800',
                        type: 'cost',
                        details: [
                            { label: 'Litres used', value: '2,150L' },
                            { label: 'Price per litre', value: '1.30' }
                        ],
                        percent: 43
                    },
                    {
                        name: 'Servicing & Maintenance',
                        amount: '2,450',
                        type: 'cost',
                        details: [
                            { label: 'Services', value: '3 tractors serviced' },
                            { label: 'Next due', value: '2 machines' }
                        ],
                        percent: 38
                    },
                    {
                        name: 'Parts & Repairs',
                        amount: '900',
                        type: 'cost',
                        details: [
                            { label: 'Parts ordered', value: '8 items' },
                            { label: 'Emergency repairs', value: '1 this month' }
                        ],
                        percent: 14
                    },
                    {
                        name: 'Insurance & Road Tax',
                        amount: '300',
                        type: 'cost',
                        details: [
                            { label: 'Coverage', value: '23 machines' },
                            { label: 'Monthly premium', value: '300' }
                        ],
                        percent: 5
                    }
                ],
                transactions: [
                    { title: 'Bulk Diesel Delivery', date: '18 Dec 2025', subcategory: 'Fuel & Diesel', field: 'Estate Wide', amount: '2,800', type: 'expense' },
                    { title: 'Tractor Service - JD 6155R', date: '15 Dec 2025', subcategory: 'Servicing & Maintenance', field: 'Machinery Barn', amount: '850', type: 'expense' },
                    { title: 'Tractor Service - MF 5713', date: '12 Dec 2025', subcategory: 'Servicing & Maintenance', field: 'Machinery Barn', amount: '920', type: 'expense' },
                    { title: 'Tractor Service - NH T6.180', date: '08 Dec 2025', subcategory: 'Servicing & Maintenance', field: 'Machinery Barn', amount: '680', type: 'expense' },
                    { title: 'Tyre Replacement', date: '10 Dec 2025', subcategory: 'Parts & Repairs', field: 'Machinery Barn', amount: '600', type: 'expense' },
                    { title: 'Hydraulic Hose Kit', date: '05 Dec 2025', subcategory: 'Parts & Repairs', field: 'Machinery Barn', amount: '300', type: 'expense' },
                    { title: 'Monthly Insurance', date: '01 Dec 2025', subcategory: 'Insurance & Road Tax', field: 'Estate Wide', amount: '300', type: 'expense' }
                ]
            },
            'feed': {
                title: 'Feed & Supplies',
                type: 'cost',
                total: '20,100',
                change: '-3.2%',
                changeType: 'positive',
                count: '24',
                percent: '21.3%',
                subcategories: [
                    {
                        name: 'Cattle Feed',
                        amount: '8,500',
                        type: 'cost',
                        details: [
                            { label: 'Supplier', value: 'ForFarmers UK' },
                            { label: 'Cost per bag', value: '15.20 (25kg)' },
                            { label: 'Usage', value: '560 bags/month' },
                            { label: 'Stock level', value: '120 bags (2.5 weeks)' },
                            { label: 'Reorder threshold', value: '80 bags' }
                        ],
                        percent: 42
                    },
                    {
                        name: 'Sheep Feed',
                        amount: '4,200',
                        type: 'cost',
                        details: [
                            { label: 'Supplier', value: 'Carr\'s Billington' },
                            { label: 'Cost per bag', value: '12.80 (20kg)' },
                            { label: 'Usage', value: '330 bags/month' },
                            { label: 'Stock level', value: '85 bags (3 weeks)' },
                            { label: 'Reorder threshold', value: '60 bags' }
                        ],
                        percent: 21
                    },
                    {
                        name: 'Supplements & Minerals',
                        amount: '2,300',
                        type: 'cost',
                        details: [
                            { label: 'Supplier', value: 'Multiple suppliers' },
                            { label: 'Types', value: 'Vitamins, minerals, licks' },
                            { label: 'Usage', value: 'Seasonal variation' },
                            { label: 'Stock level', value: 'Good' }
                        ],
                        percent: 11
                    },
                    {
                        name: 'Hay & Silage',
                        amount: '5,100',
                        type: 'cost',
                        details: [
                            { label: 'Supplier', value: 'Local farmers' },
                            { label: 'Hay bales', value: '4.50/bale' },
                            { label: 'Usage', value: '1,130 bales/month' },
                            { label: 'Stock level', value: '2,400 bales (2 months)' },
                            { label: 'Reorder threshold', value: '1,000 bales' }
                        ],
                        percent: 25
                    }
                ],
                transactions: [
                    { title: 'Cattle Feed Bulk Order', date: '20 Dec 2025', subcategory: 'Cattle Feed', field: 'North Pasture', amount: '8,500', type: 'expense' },
                    { title: 'Hay Bales Delivery', date: '18 Dec 2025', subcategory: 'Hay & Silage', field: 'Estate Wide', amount: '5,100', type: 'expense' },
                    { title: 'Sheep Feed Delivery', date: '15 Dec 2025', subcategory: 'Sheep Feed', field: 'East Meadow', amount: '4,200', type: 'expense' },
                    { title: 'Mineral Supplements', date: '12 Dec 2025', subcategory: 'Supplements & Minerals', field: 'North Pasture', amount: '1,600', type: 'expense' },
                    { title: 'Vitamin Blocks', date: '08 Dec 2025', subcategory: 'Supplements & Minerals', field: 'Estate Wide', amount: '700', type: 'expense' }
                ],
                analytics: {
                    costTrends: 'Feed costs down 3.2% vs last month due to bulk purchasing',
                    usagePattern: 'Seasonal increase expected in winter months',
                    pricePerUnit: 'Cattle feed 0.61/kg | Sheep feed 0.64/kg',
                    supplierComparison: 'ForFarmers 5% cheaper than previous supplier'
                }
            },
            'veterinary': {
                title: 'Veterinary Services',
                type: 'cost',
                total: '4,850',
                change: '+12.5%',
                changeType: 'negative',
                count: '12',
                percent: '5.1%',
                subcategories: [
                    {
                        name: 'Routine Health Checks',
                        amount: '1,800',
                        type: 'cost',
                        details: [
                            { label: 'Herd checks', value: '2 visits this month' },
                            { label: 'Animals checked', value: '280 cattle, 120 sheep' }
                        ],
                        percent: 37
                    },
                    {
                        name: 'Vaccinations & Preventive Care',
                        amount: '1,400',
                        type: 'cost',
                        details: [
                            { label: 'Cattle vaccinations', value: '180 head' },
                            { label: 'Sheep treatments', value: '60 head' }
                        ],
                        percent: 29
                    },
                    {
                        name: 'Treatments & Medications',
                        amount: '1,050',
                        type: 'cost',
                        details: [
                            { label: 'Cases treated', value: '8 this month' },
                            { label: 'Emergency calls', value: '1 this month' }
                        ],
                        percent: 22
                    },
                    {
                        name: 'Emergency Callouts',
                        amount: '600',
                        type: 'cost',
                        details: [
                            { label: 'Out of hours', value: '1 callout' },
                            { label: 'Cost per callout', value: '600 average' }
                        ],
                        percent: 12
                    }
                ],
                transactions: [
                    { title: 'Herd Health Check', date: '20 Dec 2025', subcategory: 'Routine Health Checks', field: 'North Pasture', amount: '900', type: 'expense' },
                    { title: 'Herd Health Check', date: '15 Dec 2025', subcategory: 'Routine Health Checks', field: 'North Pasture', amount: '900', type: 'expense' },
                    { title: 'Cattle Vaccinations', date: '18 Dec 2025', subcategory: 'Vaccinations & Preventive Care', field: 'North Pasture', amount: '1,100', type: 'expense' },
                    { title: 'Sheep Foot Treatment', date: '12 Dec 2025', subcategory: 'Treatments & Medications', field: 'East Meadow', amount: '450', type: 'expense' },
                    { title: 'Emergency Callout - Difficult Birth', date: '10 Dec 2025', subcategory: 'Emergency Callouts', field: 'North Pasture', amount: '600', type: 'expense' },
                    { title: 'Routine Medications', date: '08 Dec 2025', subcategory: 'Treatments & Medications', field: 'Estate Wide', amount: '600', type: 'expense' },
                    { title: 'Sheep Vaccinations', date: '05 Dec 2025', subcategory: 'Vaccinations & Preventive Care', field: 'East Meadow', amount: '300', type: 'expense' }
                ]
            },
            'maintenance': {
                title: 'Property Maintenance',
                type: 'cost',
                total: '8,200',
                change: '+5.4%',
                changeType: 'negative',
                count: '15',
                percent: '8.7%',
                subcategories: [
                    {
                        name: 'Fencing & Gates',
                        amount: '3,200',
                        type: 'cost',
                        details: [
                            { label: 'Projects', value: '2 active this month' },
                            { label: 'Materials', value: 'Posts, wire, gates' }
                        ],
                        percent: 39
                    },
                    {
                        name: 'Building Repairs',
                        amount: '2,800',
                        type: 'cost',
                        details: [
                            { label: 'Barn roof repair', value: '1 project' },
                            { label: 'Other repairs', value: 'Guttering, doors' }
                        ],
                        percent: 34
                    },
                    {
                        name: 'Roads & Drainage',
                        amount: '1,500',
                        type: 'cost',
                        details: [
                            { label: 'Road grading', value: '2km completed' },
                            { label: 'Drainage work', value: '3 ditches cleared' }
                        ],
                        percent: 18
                    },
                    {
                        name: 'Water Systems',
                        amount: '700',
                        type: 'cost',
                        details: [
                            { label: 'Trough maintenance', value: '6 troughs checked' },
                            { label: 'Pipe repairs', value: '2 leaks fixed' }
                        ],
                        percent: 9
                    }
                ],
                transactions: [
                    { title: 'Fence Repairs - North Pasture', date: '22 Dec 2025', subcategory: 'Fencing & Gates', field: 'North Pasture', amount: '1,800', type: 'expense' },
                    { title: 'Gate Replacement', date: '18 Dec 2025', subcategory: 'Fencing & Gates', field: 'South Crops', amount: '950', type: 'expense' },
                    { title: 'Barn Roof Repair', date: '15 Dec 2025', subcategory: 'Building Repairs', field: 'Main Barn', amount: '2,100', type: 'expense' },
                    { title: 'Road Grading', date: '10 Dec 2025', subcategory: 'Roads & Drainage', field: 'Access Roads', amount: '1,200', type: 'expense' },
                    { title: 'Water System Maintenance', date: '08 Dec 2025', subcategory: 'Water Systems', field: 'Estate Wide', amount: '450', type: 'expense' },
                    { title: 'Guttering Repair', date: '05 Dec 2025', subcategory: 'Building Repairs', field: 'Main Barn', amount: '700', type: 'expense' },
                    { title: 'Fencing Materials', date: '03 Dec 2025', subcategory: 'Fencing & Gates', field: 'Estate Wide', amount: '450', type: 'expense' },
                    { title: 'Drainage Work', date: '02 Dec 2025', subcategory: 'Roads & Drainage', field: 'South Crops', amount: '300', type: 'expense' },
                    { title: 'Water Pipe Repair', date: '01 Dec 2025', subcategory: 'Water Systems', field: 'North Pasture', amount: '250', type: 'expense' }
                ]
            },
            'crops-seeds': {
                title: 'Crops & Seeds',
                type: 'cost',
                total: '16,520',
                change: '-8.1%',
                changeType: 'positive',
                count: '18',
                percent: '17.5%',
                subcategories: [
                    {
                        name: 'Winter Wheat (62 ha)',
                        amount: '8,900',
                        type: 'cost',
                        details: [
                            { label: 'Planted', value: 'South Crops - October 2025' },
                            { label: 'Expected harvest', value: 'August 2026' },
                            { label: 'Expected yield', value: '8.5 tons/ha (527 tons)' },
                            { label: 'UK Market Price', value: '220/ton (updated daily)' },
                            { label: 'Expected revenue', value: '115,940' },
                            { label: 'Cost breakdown', value: 'Seed 3,200, Fertilizer 3,800, Spraying 1,900' }
                        ],
                        percent: 54
                    },
                    {
                        name: 'Spring Barley (38 ha)',
                        amount: '4,800',
                        type: 'cost',
                        details: [
                            { label: 'To be planted', value: 'March 2026' },
                            { label: 'Expected harvest', value: 'August 2026' },
                            { label: 'Expected yield', value: '6.2 tons/ha (236 tons)' },
                            { label: 'UK Market Price', value: '195/ton (updated daily)' },
                            { label: 'Expected revenue', value: '46,020' },
                            { label: 'Cost breakdown', value: 'Seed 2,100, Fertilizer 1,900, Spraying 800' }
                        ],
                        percent: 29
                    },
                    {
                        name: 'Oilseed Rape (25 ha)',
                        amount: '2,820',
                        type: 'cost',
                        details: [
                            { label: 'Planted', value: 'September 2025' },
                            { label: 'Expected harvest', value: 'July 2026' },
                            { label: 'Expected yield', value: '3.8 tons/ha (95 tons)' },
                            { label: 'UK Market Price', value: '425/ton (updated daily)' },
                            { label: 'Expected revenue', value: '40,375' },
                            { label: 'Cost breakdown', value: 'Seed 1,200, Fertilizer 1,100, Spraying 520' }
                        ],
                        percent: 17
                    }
                ],
                transactions: [
                    { title: 'Winter Wheat - Fertilizer Application', date: '20 Dec 2025', subcategory: 'Winter Wheat', field: 'South Crops', amount: '3,800', type: 'expense' },
                    { title: 'Winter Wheat - Seed Purchase', date: '15 Oct 2025', subcategory: 'Winter Wheat', field: 'South Crops', amount: '3,200', type: 'expense' },
                    { title: 'Winter Wheat - Herbicide Spraying', date: '05 Nov 2025', subcategory: 'Winter Wheat', field: 'South Crops', amount: '1,900', type: 'expense' },
                    { title: 'Spring Barley - Seed Purchase', date: '10 Dec 2025', subcategory: 'Spring Barley', field: 'East Field', amount: '2,100', type: 'expense' },
                    { title: 'Spring Barley - Fertilizer', date: '12 Dec 2025', subcategory: 'Spring Barley', field: 'East Field', amount: '1,900', type: 'expense' },
                    { title: 'Spring Barley - Herbicide', date: '15 Dec 2025', subcategory: 'Spring Barley', field: 'East Field', amount: '800', type: 'expense' },
                    { title: 'OSR - Seed Treatment', date: '01 Sep 2025', subcategory: 'Oilseed Rape', field: 'North Crops', amount: '1,200', type: 'expense' },
                    { title: 'OSR - Fertilizer', date: '15 Sep 2025', subcategory: 'Oilseed Rape', field: 'North Crops', amount: '1,100', type: 'expense' },
                    { title: 'OSR - Fungicide', date: '20 Oct 2025', subcategory: 'Oilseed Rape', field: 'North Crops', amount: '520', type: 'expense' }
                ],
                analytics: {
                    marketPrices: {
                        wheat: { current: '220/ton', trend: '+12 vs 3 months ago', forecast: 'Stable' },
                        barley: { current: '195/ton', trend: '+8 vs 3 months ago', forecast: 'Rising' },
                        osr: { current: '425/ton', trend: '-15 vs 3 months ago', forecast: 'Volatile' }
                    },
                    margins: {
                        wheat: { revenue: '115,940', cost: '8,900', profit: '107,040', margin: '92.3%' },
                        barley: { revenue: '46,020', cost: '4,800', profit: '41,220', margin: '89.6%' },
                        osr: { revenue: '40,375', cost: '2,820', profit: '37,555', margin: '93.0%' }
                    }
                }
            },
            'livestock-sales': {
                title: 'Livestock Sales',
                type: 'revenue',
                total: '85,400',
                change: '+18.2%',
                changeType: 'positive',
                count: '8',
                percent: '45.6%',
                subcategories: [
                    {
                        name: 'Cattle - Market Sales',
                        amount: '42,500',
                        type: 'revenue',
                        details: [
                            { label: 'Head sold', value: '28 cattle' },
                            { label: 'Avg price per head', value: '1,518' },
                            { label: 'Market', value: 'Skipton Auction Mart' }
                        ],
                        percent: 50
                    },
                    {
                        name: 'Cattle - Direct Sales',
                        amount: '28,300',
                        type: 'revenue',
                        details: [
                            { label: 'Head sold', value: '14 cattle' },
                            { label: 'Avg price per head', value: '2,021' },
                            { label: 'Buyer', value: 'Premium beef processor' }
                        ],
                        percent: 33
                    },
                    {
                        name: 'Sheep Sales',
                        amount: '14,600',
                        type: 'revenue',
                        details: [
                            { label: 'Head sold', value: '80 sheep' },
                            { label: 'Avg price per head', value: '182.50' },
                            { label: 'Market', value: 'Local auction' }
                        ],
                        percent: 17
                    }
                ],
                transactions: [
                    { title: 'Cattle Sale - Auction', date: '20 Dec 2025', subcategory: 'Cattle - Market Sales', field: 'North Pasture', amount: '42,500', type: 'revenue' },
                    { title: 'Cattle Sale - Direct', date: '15 Dec 2025', subcategory: 'Cattle - Direct Sales', field: 'North Pasture', amount: '28,300', type: 'revenue' },
                    { title: 'Sheep Sale - Auction', date: '12 Dec 2025', subcategory: 'Sheep Sales', field: 'East Meadow', amount: '14,600', type: 'revenue' }
                ]
            },
            'crop-sales': {
                title: 'Crop Sales',
                type: 'revenue',
                total: '76,200',
                change: '+9.5%',
                changeType: 'positive',
                count: '6',
                percent: '40.7%',
                subcategories: [
                    {
                        name: 'Wheat Sales',
                        amount: '48,400',
                        type: 'revenue',
                        details: [
                            { label: 'Tons sold', value: '220 tons' },
                            { label: 'Price achieved', value: '220/ton' },
                            { label: 'UK Market Price', value: '220/ton' },
                            { label: 'Price difference', value: '0 (at market rate)' }
                        ],
                        percent: 64
                    },
                    {
                        name: 'Barley Sales',
                        amount: '19,500',
                        type: 'revenue',
                        details: [
                            { label: 'Tons sold', value: '100 tons' },
                            { label: 'Price achieved', value: '195/ton' },
                            { label: 'UK Market Price', value: '195/ton' },
                            { label: 'Price difference', value: '0 (at market rate)' }
                        ],
                        percent: 26
                    },
                    {
                        name: 'Vegetable Box Sales',
                        amount: '8,300',
                        type: 'revenue',
                        details: [
                            { label: 'Boxes sold', value: '415 boxes' },
                            { label: 'Price per box', value: '20' },
                            { label: 'Delivery', value: 'Weekly to 85 subscribers' }
                        ],
                        percent: 11
                    }
                ],
                transactions: [
                    { title: 'Wheat Harvest Sale', date: '18 Dec 2025', subcategory: 'Wheat Sales', field: 'South Crops', amount: '48,400', type: 'revenue' },
                    { title: 'Barley Sale', date: '15 Dec 2025', subcategory: 'Barley Sales', field: 'South Crops', amount: '19,500', type: 'revenue' },
                    { title: 'Weekly Veg Boxes', date: '12 Dec 2025', subcategory: 'Vegetable Box Sales', field: 'Market Garden', amount: '1,700', type: 'revenue' },
                    { title: 'Weekly Veg Boxes', date: '05 Dec 2025', subcategory: 'Vegetable Box Sales', field: 'Market Garden', amount: '1,700', type: 'revenue' },
                    { title: 'Farmers Market Sales', date: '14 Dec 2025', subcategory: 'Vegetable Box Sales', field: 'Market Garden', amount: '2,450', type: 'revenue' },
                    { title: 'Wholesale Veg', date: '10 Dec 2025', subcategory: 'Vegetable Box Sales', field: 'Market Garden', amount: '2,450', type: 'revenue' }
                ]
            },
            'other-income': {
                title: 'Other Income',
                type: 'revenue',
                total: '25,850',
                change: '+15.3%',
                changeType: 'positive',
                count: '12',
                percent: '13.8%',
                subcategories: [
                    {
                        name: 'Environmental Grants',
                        amount: '12,800',
                        type: 'revenue',
                        details: [
                            { label: 'Scheme', value: 'Countryside Stewardship' },
                            { label: 'Period', value: 'Quarterly payment' }
                        ],
                        percent: 50
                    },
                    {
                        name: 'Land Rental',
                        amount: '6,400',
                        type: 'revenue',
                        details: [
                            { label: 'Tenant', value: 'Solar farm developer' },
                            { label: 'Area', value: '5 hectares' }
                        ],
                        percent: 25
                    },
                    {
                        name: 'Equipment Rental',
                        amount: '4,200',
                        type: 'revenue',
                        details: [
                            { label: 'Equipment', value: 'Telehandler, tractor' },
                            { label: 'Days rented', value: '6 days this month' }
                        ],
                        percent: 16
                    },
                    {
                        name: 'Consultancy & Farm Tours',
                        amount: '2,450',
                        type: 'revenue',
                        details: [
                            { label: 'Services', value: 'Farm advice, educational tours' },
                            { label: 'Clients', value: '3 this month' }
                        ],
                        percent: 9
                    }
                ],
                transactions: [
                    { title: 'Countryside Stewardship - Q4', date: '20 Dec 2025', subcategory: 'Environmental Grants', field: 'Estate Wide', amount: '12,800', type: 'revenue' },
                    { title: 'Land Rental - Monthly', date: '15 Dec 2025', subcategory: 'Land Rental', field: 'South Field', amount: '6,400', type: 'revenue' },
                    { title: 'Equipment Rental - Telehandler', date: '12 Dec 2025', subcategory: 'Equipment Rental', field: 'Machinery Barn', amount: '2,400', type: 'revenue' },
                    { title: 'Equipment Rental - Tractor', date: '08 Dec 2025', subcategory: 'Equipment Rental', field: 'Machinery Barn', amount: '1,800', type: 'revenue' },
                    { title: 'Farm Consultancy', date: '10 Dec 2025', subcategory: 'Consultancy & Farm Tours', field: 'Estate Wide', amount: '1,300', type: 'revenue' },
                    { title: 'Educational Farm Tour', date: '05 Dec 2025', subcategory: 'Consultancy & Farm Tours', field: 'Estate Wide', amount: '650', type: 'revenue' },
                    { title: 'School Visit', date: '03 Dec 2025', subcategory: 'Consultancy & Farm Tours', field: 'Estate Wide', amount: '500', type: 'revenue' }
                ]
            }
        };

        let currentCategoryData = null;
        let showingAllTransactions = false;
        let currentTransactionFilter = { search: '', subcategory: '', sort: 'date-desc' };

        function openCategoryDetail(category) {
            const data = categoryDetailData[category];
            if (!data) return;

            currentCategoryData = data;
            showingAllTransactions = false;
            currentTransactionFilter = { search: '', subcategory: '', sort: 'date-desc' };

            // Update modal title and subtitle
            document.getElementById('opsModalTitle').textContent = data.title;
            document.getElementById('opsModalSubtitle').textContent = 'Detailed breakdown and analytics';

            // Update summary cards
            document.getElementById('opsModalLabel1').textContent = data.type === 'cost' ? 'Total Cost' : 'Total Revenue';
            document.getElementById('opsModalTotal').textContent = data.total;
            
            const changeEl = document.getElementById('opsModalChange');
            if (changeEl) {
                changeEl.textContent = `${data.change} vs last month`;
                changeEl.className = `ops-summary-change ${data.changeType}`;
            }
            
            document.getElementById('opsModalCount').textContent = data.count;
            document.getElementById('opsModalPercent').textContent = data.percent;

            // Render sub-categories
            renderSubcategories(data.subcategories, data.type);

            // Render transactions (initially showing recent only)
            renderTransactions(false);

            // Setup subcategory filter options
            const subcatFilter = document.getElementById('opsSubcatFilter');
            if (subcatFilter) {
                subcatFilter.innerHTML = '<option value="">All Sub-Categories</option>' +
                    data.subcategories.map(sub => `<option value="${sub.name}">${sub.name}</option>`).join('');
            }

            // Show/hide analytics section for specific categories
            const analyticsSection = document.getElementById('opsAnalytics');
            if (data.analytics) {
                analyticsSection.style.display = 'block';
                renderAnalytics(data.analytics, category);
            } else {
                analyticsSection.style.display = 'none';
            }

            // Hide field breakdown for now (can be added later)
            document.getElementById('opsFieldBreakdown').style.display = 'none';

            // Show modal
            document.getElementById('opsDetailModal').classList.add('active');
        }

        function renderSubcategories(subcategories, type) {
            const container = document.getElementById('opsSubcategoryList');
            if (!container || !subcategories) return;

            container.innerHTML = subcategories.map(sub => `
                <div class="subcategory-item" onclick="filterBySubcategory('${sub.name}')">
                    <div class="subcategory-header">
                        <div class="subcategory-name">${sub.name}</div>
                        <div class="subcategory-amount ${type}">${sub.amount}</div>
                    </div>
                    <div class="subcategory-details">
                        ${sub.details.map(detail => `
                            <div class="subcategory-detail-item">
                                <span class="subcategory-detail-label">${detail.label}:</span>
                                <span>${detail.value}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${sub.percent ? `
                        <div class="subcategory-progress">
                            <div class="subcategory-progress-fill" style="width: ${sub.percent}%;"></div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderTransactions(showAll) {
            if (!currentCategoryData) return;

            const container = document.getElementById('opsTransactionList');
            const showAllBtn = document.getElementById('opsShowAllBtn');
            const filters = document.getElementById('opsTransactionFilters');

            if (!container) return;

            // Filter and sort transactions
            let transactions = [...currentCategoryData.transactions];

            // Apply search filter
            if (currentTransactionFilter.search) {
                const search = currentTransactionFilter.search.toLowerCase();
                transactions = transactions.filter(t => 
                    t.title.toLowerCase().includes(search) ||
                    t.subcategory.toLowerCase().includes(search) ||
                    t.field.toLowerCase().includes(search)
                );
            }

            // Apply subcategory filter
            if (currentTransactionFilter.subcategory) {
                transactions = transactions.filter(t => t.subcategory === currentTransactionFilter.subcategory);
            }

            // Apply sorting
            transactions.sort((a, b) => {
                const amountA = parseFloat(a.amount.replace(/[,]/g, ''));
                const amountB = parseFloat(b.amount.replace(/[,]/g, ''));
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);

                switch(currentTransactionFilter.sort) {
                    case 'date-desc': return dateB - dateA;
                    case 'date-asc': return dateA - dateB;
                    case 'amount-desc': return amountB - amountA;
                    case 'amount-asc': return amountA - amountB;
                    default: return dateB - dateA;
                }
            });

            // Limit to recent if not showing all
            const displayTransactions = showAll ? transactions : transactions.slice(0, 5);

            container.innerHTML = displayTransactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-title">${t.title}</div>
                        <div class="transaction-meta">
                            <span> ${t.date}</span>
                            <span> ${t.field}</span>
                            <span> ${t.subcategory}</span>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type}">${t.type === 'revenue' ? '+' : ''}${t.amount}</div>
                </div>
            `).join('');

            // Update Show All button
            if (showAllBtn) {
                if (showAll) {
                    showAllBtn.textContent = ' Show Recent';
                    showAllBtn.classList.add('active');
                    if (filters) filters.style.display = 'grid';
                } else {
                    showAllBtn.textContent = 'Show All ';
                    showAllBtn.classList.remove('active');
                    if (filters) filters.style.display = 'none';
                }
            }

            showingAllTransactions = showAll;
        }

        function renderAnalytics(analytics, category) {
            const container = document.getElementById('opsAnalyticsContent');
            if (!container) return;

            if (category === 'crops-seeds' && analytics.marketPrices) {
                container.innerHTML = `
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <div class="analytics-card-title">Winter Wheat Market</div>
                            <div class="analytics-card-value" style="color: #16a34a;">${analytics.marketPrices.wheat.current}</div>
                            <div class="analytics-card-detail">${analytics.marketPrices.wheat.trend}</div>
                            <div class="analytics-card-detail">Forecast: ${analytics.marketPrices.wheat.forecast}</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-card-title">Spring Barley Market</div>
                            <div class="analytics-card-value" style="color: #16a34a;">${analytics.marketPrices.barley.current}</div>
                            <div class="analytics-card-detail">${analytics.marketPrices.barley.trend}</div>
                            <div class="analytics-card-detail">Forecast: ${analytics.marketPrices.barley.forecast}</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-card-title">Oilseed Rape Market</div>
                            <div class="analytics-card-value" style="color: #16a34a;">${analytics.marketPrices.osr.current}</div>
                            <div class="analytics-card-detail">${analytics.marketPrices.osr.trend}</div>
                            <div class="analytics-card-detail">Forecast: ${analytics.marketPrices.osr.forecast}</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">Projected Margins</h4>
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <div class="analytics-card-title">Winter Wheat</div>
                                <div class="analytics-card-value" style="color: #16a34a;">${analytics.margins.wheat.margin}</div>
                                <div class="analytics-card-detail">Revenue: ${analytics.margins.wheat.revenue}</div>
                                <div class="analytics-card-detail">Cost: ${analytics.margins.wheat.cost}</div>
                                <div class="analytics-card-detail">Profit: ${analytics.margins.wheat.profit}</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-card-title">Spring Barley</div>
                                <div class="analytics-card-value" style="color: #16a34a;">${analytics.margins.barley.margin}</div>
                                <div class="analytics-card-detail">Revenue: ${analytics.margins.barley.revenue}</div>
                                <div class="analytics-card-detail">Cost: ${analytics.margins.barley.cost}</div>
                                <div class="analytics-card-detail">Profit: ${analytics.margins.barley.profit}</div>
                            </div>
                            <div class="analytics-card">
                                <div class="analytics-card-title">Oilseed Rape</div>
                                <div class="analytics-card-value" style="color: #16a34a;">${analytics.margins.osr.margin}</div>
                                <div class="analytics-card-detail">Revenue: ${analytics.margins.osr.revenue}</div>
                                <div class="analytics-card-detail">Cost: ${analytics.margins.osr.cost}</div>
                                <div class="analytics-card-detail">Profit: ${analytics.margins.osr.profit}</div>
                            </div>
                        </div>
                        <div style="margin-top: 16px; padding: 16px; background: #fef3c7; border-radius: 8px; font-size: 13px;">
                            <strong> Market Price Data:</strong> Prices updated daily from AHDB (Agriculture and Horticulture Development Board). 
                            Historical data and forecasts help optimize selling decisions.
                        </div>
                    </div>
                `;
            } else if (category === 'feed' && analytics) {
                container.innerHTML = `
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <div class="analytics-card-title">Cost Trend</div>
                            <div class="analytics-card-value" style="color: #16a34a;">-3.2%</div>
                            <div class="analytics-card-detail">${analytics.costTrends}</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-card-title">Price per Unit</div>
                            <div class="analytics-card-value" style="font-size: 20px;">0.61/kg</div>
                            <div class="analytics-card-detail">${analytics.pricePerUnit}</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-card-title">Usage Pattern</div>
                            <div class="analytics-card-value" style="font-size: 20px;"></div>
                            <div class="analytics-card-detail">${analytics.usagePattern}</div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-card-title">Supplier Savings</div>
                            <div class="analytics-card-value" style="color: #16a34a;">5%</div>
                            <div class="analytics-card-detail">${analytics.supplierComparison}</div>
                        </div>
                    </div>
                `;
            }
        }

        function toggleShowAllTransactions() {
            renderTransactions(!showingAllTransactions);
        }

        function filterBySubcategory(subcategory) {
            currentTransactionFilter.subcategory = subcategory;
            document.getElementById('opsSubcatFilter').value = subcategory;
            showingAllTransactions = true;
            renderTransactions(true);
        }

        function filterOpsTransactions() {
            const searchInput = document.getElementById('opsSearchInput');
            const subcatFilter = document.getElementById('opsSubcatFilter');
            const sortBy = document.getElementById('opsSortBy');

            if (searchInput) currentTransactionFilter.search = searchInput.value;
            if (subcatFilter) currentTransactionFilter.subcategory = subcatFilter.value;
            if (sortBy) currentTransactionFilter.sort = sortBy.value;

            renderTransactions(true);
        }

        function selectOpsPeriod(element, period) {
            // Remove active from all
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            // Add active to clicked
            element.classList.add('active');
            
            // In real app, would reload data for selected period
            alert(`Period changed to: ${period}\n\nIn production, this would:\n- Reload all data for selected period\n- Update trend chart\n- Recalculate all totals and percentages`);
        }

        function openAddTransactionForm() {
            if (!currentCategoryData) return;
            
            alert(`Add Transaction to ${currentCategoryData.title}\n\nThis would open a form with:\n- Date picker\n- Amount input\n- Sub-category selector\n- Field selector\n- Description/notes\n- Vendor/buyer (optional)\n- Invoice upload (optional)\n\nTransaction would be saved and immediately reflected in all views.`);
        }

        function generateOpsReport() {
            if (!currentCategoryData) return;
            
            alert(`Generate Report for ${currentCategoryData.title}\n\nThis would create a comprehensive PDF report including:\n- Summary statistics\n- Trend charts\n- Sub-category breakdown\n- All transactions\n- Analytics and insights\n- Period comparisons\n\nReport would be downloadable or emailable.`);
        }

        // Operations drill-down functions
        function drillDownCategory(category) {
            const categoryData = {
                'Labour': {
                    title: 'Labour Costs',
                    subtitle: 'Staff wages and contractors',
                    total: '38,200',
                    count: '12',
                    percent: '40.5%',
                    transactions: [
                        { title: 'Monthly Staff Wages', date: '01 Dec', field: 'Estate Wide', amount: '28,500', type: 'expense' },
                        { title: 'Contractor - Fencing Work', date: '15 Dec', field: 'North Pasture', amount: '3,200', type: 'expense' },
                        { title: 'Contractor - Spraying', date: '10 Dec', field: 'South Crops', amount: '2,800', type: 'expense' },
                        { title: 'Seasonal Workers', date: '05 Dec', field: 'West Orchard', amount: '2,400', type: 'expense' },
                        { title: 'Farm Consultant', date: '03 Dec', field: 'Estate Wide', amount: '1,300', type: 'expense' }
                    ],
                    fieldBreakdown: [
                        { field: 'Estate Wide', amount: '29,800', hours: '450 hrs' },
                        { field: 'North Pasture', amount: '3,200', hours: '48 hrs' },
                        { field: 'South Crops', amount: '2,800', hours: '35 hrs' },
                        { field: 'West Orchard', amount: '2,400', hours: '32 hrs' }
                    ]
                },
                'Feed': {
                    title: 'Feed & Supplies',
                    subtitle: 'Animal feed and supplements',
                    total: '22,450',
                    count: '8',
                    percent: '23.8%',
                    transactions: [
                        { title: 'Cattle Feed - Bulk Order', date: '20 Dec', field: 'North Pasture', amount: '8,500', type: 'expense' },
                        { title: 'Mineral Supplements', date: '18 Dec', field: 'North Pasture', amount: '2,300', type: 'expense' },
                        { title: 'Sheep Feed', date: '15 Dec', field: 'East Meadow', amount: '4,200', type: 'expense' },
                        { title: 'Hay Bales', date: '12 Dec', field: 'Estate Wide', amount: '5,100', type: 'expense' },
                        { title: 'Silage Supplies', date: '08 Dec', field: 'North Pasture', amount: '2,350', type: 'expense' }
                    ],
                    fieldBreakdown: [
                        { field: 'North Pasture', amount: '13,150', detail: 'Cattle feed & supplements' },
                        { field: 'East Meadow', amount: '4,200', detail: 'Sheep feed' },
                        { field: 'Estate Wide', amount: '5,100', detail: 'Hay storage' }
                    ]
                },
                'Machinery': {
                    title: 'Machinery & Fuel',
                    subtitle: 'Equipment, maintenance, and diesel',
                    total: '18,670',
                    count: '15',
                    percent: '19.8%',
                    transactions: [
                        { title: 'Diesel Fuel', date: '22 Dec', field: 'Estate Wide', amount: '4,500', type: 'expense' },
                        { title: 'Tractor Maintenance', date: '18 Dec', field: 'Machinery Barn', amount: '3,200', type: 'expense' },
                        { title: 'Equipment Parts', date: '15 Dec', field: 'Machinery Barn', amount: '2,850', type: 'expense' },
                        { title: 'Combine Harvester Service', date: '10 Dec', field: 'Machinery Barn', amount: '4,800', type: 'expense' },
                        { title: 'Oil & Lubricants', date: '08 Dec', field: 'Estate Wide', amount: '1,320', type: 'expense' },
                        { title: 'Small Tools & Supplies', date: '05 Dec', field: 'Estate Wide', amount: '2,000', type: 'expense' }
                    ],
                    fieldBreakdown: [
                        { field: 'Estate Wide', amount: '7,820', detail: 'Fuel & supplies' },
                        { field: 'Machinery Barn', amount: '10,850', detail: 'Maintenance & parts' }
                    ]
                },
                'Veterinary': {
                    title: 'Veterinary Services',
                    subtitle: 'Health checks and treatments',
                    total: '8,500',
                    count: '6',
                    percent: '9.0%',
                    transactions: [
                        { title: 'Herd Health Check', date: '20 Dec', field: 'North Pasture', amount: '2,800', type: 'expense' },
                        { title: 'Vaccinations - Cattle', date: '15 Dec', field: 'North Pasture', amount: '1,900', type: 'expense' },
                        { title: 'Sheep Foot Treatment', date: '12 Dec', field: 'East Meadow', amount: '1,200', type: 'expense' },
                        { title: 'Emergency Call Out', date: '10 Dec', field: 'North Pasture', amount: '1,800', type: 'expense' },
                        { title: 'Routine Medications', date: '05 Dec', field: 'Estate Wide', amount: '800', type: 'expense' }
                    ],
                    fieldBreakdown: [
                        { field: 'North Pasture', amount: '6,500', detail: 'Cattle care' },
                        { field: 'East Meadow', amount: '1,200', detail: 'Sheep care' },
                        { field: 'Estate Wide', amount: '800', detail: 'Preventive care' }
                    ]
                },
                'Maintenance': {
                    title: 'Property Maintenance',
                    subtitle: 'Fencing, buildings, and roads',
                    total: '6,500',
                    count: '9',
                    percent: '6.9%',
                    transactions: [
                        { title: 'Fence Repairs', date: '22 Dec', field: 'North Pasture', amount: '1,800', type: 'expense' },
                        { title: 'Gate Replacement', date: '18 Dec', field: 'South Crops', amount: '950', type: 'expense' },
                        { title: 'Barn Roof Repair', date: '15 Dec', field: 'Main Barn', amount: '2,100', type: 'expense' },
                        { title: 'Road Grading', date: '10 Dec', field: 'Access Roads', amount: '1,200', type: 'expense' },
                        { title: 'Water System Maintenance', date: '05 Dec', field: 'Estate Wide', amount: '450', type: 'expense' }
                    ],
                    fieldBreakdown: [
                        { field: 'North Pasture', amount: '1,800', detail: 'Fencing' },
                        { field: 'South Crops', amount: '950', detail: 'Gates' },
                        { field: 'Buildings', amount: '2,100', detail: 'Structural' },
                        { field: 'Infrastructure', amount: '1,650', detail: 'Roads & water' }
                    ]
                }
            };

            const data = categoryData[category];
            if (!data) return;

            // Update modal content
            document.getElementById('opsModalTitle').textContent = data.title;
            document.getElementById('opsModalSubtitle').textContent = `${data.subtitle}  This Month`;
            document.getElementById('opsModalTotal').textContent = data.total;
            document.getElementById('opsModalCount').textContent = data.count;
            document.getElementById('opsModalPercent').textContent = data.percent;

            // Update transactions
            const transactionList = document.getElementById('opsTransactionList');
            transactionList.innerHTML = data.transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-title">${t.title}</div>
                        <div class="transaction-meta">
                            <span> ${t.date}</span>
                            <span> ${t.field}</span>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type}">${t.amount}</div>
                </div>
            `).join('');

            // Update field breakdown
            if (data.fieldBreakdown) {
                document.getElementById('opsFieldBreakdown').style.display = 'block';
                document.getElementById('opsFieldGrid').innerHTML = data.fieldBreakdown.map(f => `
                    <div class="field-profit-card" onclick="alert('Would drill into ${f.field} details')">
                        <div class="field-profit-name">${f.field}</div>
                        <div class="field-profit-details">${f.detail || f.hours}</div>
                        <div class="field-profit-amount" style="color: #dc2626;">${f.amount}</div>
                    </div>
                `).join('');
            } else {
                document.getElementById('opsFieldBreakdown').style.display = 'none';
            }

            document.getElementById('opsDetailModal').classList.add('active');
        }

        function drillDownRevenue(source) {
            const revenueData = {
                'Livestock': {
                    title: 'Livestock Sales',
                    subtitle: 'Cattle and sheep sales',
                    total: '98,200',
                    count: '8',
                    percent: '52.4%',
                    transactions: [
                        { title: 'Cattle Sale - Market', date: '20 Dec', field: 'North Pasture', amount: '42,500', type: 'revenue' },
                        { title: 'Cattle Sale - Direct', date: '15 Dec', field: 'North Pasture', amount: '28,300', type: 'revenue' },
                        { title: 'Sheep Sale - Auction', date: '12 Dec', field: 'East Meadow', amount: '18,600', type: 'revenue' },
                        { title: 'Breeding Stock Sale', date: '08 Dec', field: 'North Pasture', amount: '8,800', type: 'revenue' }
                    ],
                    fieldBreakdown: [
                        { field: 'North Pasture', amount: '79,600', detail: 'Cattle sales' },
                        { field: 'East Meadow', amount: '18,600', detail: 'Sheep sales' }
                    ]
                },
                'Crops': {
                    title: 'Crop Sales',
                    subtitle: 'Grain and vegetables',
                    total: '54,750',
                    count: '6',
                    percent: '29.2%',
                    transactions: [
                        { title: 'Wheat Harvest Sale', date: '18 Dec', field: 'South Crops', amount: '32,400', type: 'revenue' },
                        { title: 'Barley Sale', date: '15 Dec', field: 'South Crops', amount: '15,200', type: 'revenue' },
                        { title: 'Vegetable Box Sales', date: '10 Dec', field: 'South Crops', amount: '4,800', type: 'revenue' },
                        { title: 'Seed Sale', date: '05 Dec', field: 'South Crops', amount: '2,350', type: 'revenue' }
                    ],
                    fieldBreakdown: [
                        { field: 'South Crops', amount: '54,750', detail: 'All crop sales' }
                    ]
                },
                'Orchard': {
                    title: 'Orchard Products',
                    subtitle: 'Fruit and preserves',
                    total: '22,800',
                    count: '12',
                    percent: '12.2%',
                    transactions: [
                        { title: 'Apple Sales - Wholesale', date: '20 Dec', field: 'West Orchard', amount: '12,400', type: 'revenue' },
                        { title: 'Apple Sales - Farmers Market', date: '15 Dec', field: 'West Orchard', amount: '5,600', type: 'revenue' },
                        { title: 'Apple Juice Sales', date: '12 Dec', field: 'West Orchard', amount: '2,800', type: 'revenue' },
                        { title: 'Preserves & Jams', date: '08 Dec', field: 'West Orchard', amount: '2,000', type: 'revenue' }
                    ],
                    fieldBreakdown: [
                        { field: 'West Orchard', amount: '22,800', detail: 'All orchard products' }
                    ]
                },
                'Other': {
                    title: 'Other Income',
                    subtitle: 'Grants, rentals, and misc',
                    total: '11,700',
                    count: '5',
                    percent: '6.2%',
                    transactions: [
                        { title: 'Environmental Grant', date: '20 Dec', field: 'Estate Wide', amount: '5,800', type: 'revenue' },
                        { title: 'Equipment Rental', date: '15 Dec', field: 'Machinery Barn', amount: '2,400', type: 'revenue' },
                        { title: 'Land Rental', date: '10 Dec', field: 'Estate Wide', amount: '2,200', type: 'revenue' },
                        { title: 'Consultation Fees', date: '05 Dec', field: 'Estate Wide', amount: '1,300', type: 'revenue' }
                    ],
                    fieldBreakdown: null
                }
            };

            const data = revenueData[source];
            if (!data) return;

            // Update modal content
            document.getElementById('opsModalTitle').textContent = data.title;
            document.getElementById('opsModalSubtitle').textContent = `${data.subtitle}  This Month`;
            document.getElementById('opsModalTotal').textContent = data.total;
            document.getElementById('opsModalCount').textContent = data.count;
            document.getElementById('opsModalPercent').textContent = data.percent;

            // Update transactions
            const transactionList = document.getElementById('opsTransactionList');
            transactionList.innerHTML = data.transactions.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-title">${t.title}</div>
                        <div class="transaction-meta">
                            <span> ${t.date}</span>
                            <span> ${t.field}</span>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type}">+${t.amount}</div>
                </div>
            `).join('');

            // Update field breakdown
            if (data.fieldBreakdown) {
                document.getElementById('opsFieldBreakdown').style.display = 'block';
                document.getElementById('opsFieldGrid').innerHTML = data.fieldBreakdown.map(f => `
                    <div class="field-profit-card" onclick="alert('Would drill into ${f.field} details')">
                        <div class="field-profit-name">${f.field}</div>
                        <div class="field-profit-details">${f.detail}</div>
                        <div class="field-profit-amount">+${f.amount}</div>
                    </div>
                `).join('');
            } else {
                document.getElementById('opsFieldBreakdown').style.display = 'none';
            }

            document.getElementById('opsDetailModal').classList.add('active');
        }

        function closeOpsModal() {
            document.getElementById('opsDetailModal').classList.remove('active');
        }

        function exportOpsData() {
            alert('Export functionality!\n\nThis would:\n- Generate CSV/Excel file\n- Include all transaction details\n- Download to user device');
        }

        function updateOperationsData() {
            alert('Filters applied!\n\nThis would update:\n- All metrics and totals\n- Chart visualizations\n- Breakdown lists\n- Field-level profitability');
        }

        // Close ops modal on overlay click
        document.getElementById('opsDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeOpsModal();
            }
        });

        // Notifications System
        const notificationsData = [
            {
                id: 1,
                type: 'task',
                icon: '',
                title: 'Task Assigned',
                message: 'You have been assigned "Check fence perimeter" in North Pasture',
                time: '5 minutes ago',
                unread: true,
                action: () => openTaskModal('task-3')
            },
            {
                id: 2,
                type: 'task',
                icon: '',
                title: 'Task Completed',
                message: 'John Smith completed "Spray weeds in access roads"',
                time: '1 hour ago',
                unread: true,
                action: () => openTaskModal('task-6')
            },
            {
                id: 3,
                type: 'field',
                icon: '',
                title: 'Field Health Update',
                message: 'North Pasture field health status changed to "Good"',
                time: '3 hours ago',
                unread: true,
                action: () => showFieldDetail('North Pasture')
            },
            {
                id: 4,
                type: 'alert',
                icon: '',
                title: 'Water Trough Maintenance Due',
                message: 'High priority task due tomorrow in North Pasture',
                time: '5 hours ago',
                unread: true,
                action: () => openTaskModal('task-1')
            },
            {
                id: 5,
                type: 'system',
                icon: '',
                title: 'Monthly Report Ready',
                message: 'December financial report is ready for review',
                time: '1 day ago',
                unread: true,
                action: () => {
                    switchView('operations');
                    document.querySelector('.nav-item.active').classList.remove('active');
                    document.querySelectorAll('.nav-item')[2].classList.add('active');
                }
            },
            {
                id: 6,
                type: 'task',
                icon: '',
                title: 'Task Comment',
                message: 'Sarah Johnson added a comment to "Fence inspection"',
                time: '1 day ago',
                unread: false,
                action: () => openTaskModal('task-3')
            },
            {
                id: 7,
                type: 'field',
                icon: '',
                title: 'Livestock Rotation Complete',
                message: 'Main Cattle Herd A moved to fresh grazing area',
                time: '2 days ago',
                unread: false,
                action: () => showFieldDetail('North Pasture')
            },
            {
                id: 8,
                type: 'alert',
                icon: '',
                title: 'Equipment Maintenance',
                message: 'Tractor service scheduled for next week',
                time: '3 days ago',
                unread: false,
                action: () => alert('Would navigate to equipment maintenance schedule')
            }
        ];

        let currentFilter = 'all';

        function openNotifications() {
            document.getElementById('notificationsPanel').classList.add('active');
            document.getElementById('notificationOverlay').style.display = 'block';
            renderNotifications();
        }

        function closeNotifications() {
            document.getElementById('notificationsPanel').classList.remove('active');
            document.getElementById('notificationOverlay').style.display = 'none';
        }

        function filterNotifications(filter) {
            currentFilter = filter;
            
            // Update active tab
            document.querySelectorAll('.notification-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderNotifications();
        }

        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            let filtered = notificationsData;

            // Apply filter
            if (currentFilter !== 'all') {
                const filterMap = {
                    'tasks': 'task',
                    'fields': 'field',
                    'alerts': 'alert'
                };
                filtered = notificationsData.filter(n => n.type === filterMap[currentFilter]);
            }

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="notification-empty">
                        <div class="notification-empty-icon"></div>
                        <div>No ${currentFilter === 'all' ? '' : currentFilter} notifications</div>
                    </div>
                `;
                return;
            }

            list.innerHTML = filtered.map(notification => `
                <div class="notification-item ${notification.unread ? 'unread' : ''}" onclick="handleNotificationClick(${notification.id})">
                    <div class="notification-content">
                        <div class="notification-icon-box ${notification.type}">
                            ${notification.icon}
                        </div>
                        <div class="notification-details">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${notification.time}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Update badge count
            const unreadCount = notificationsData.filter(n => n.unread).length;
            const badge = document.querySelector('.notification-badge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        function handleNotificationClick(id) {
            const notification = notificationsData.find(n => n.id === id);
            if (!notification) return;

            // Mark as read
            notification.unread = false;
            renderNotifications();

            // Close notifications panel
            closeNotifications();

            // Execute action
            if (notification.action) {
                setTimeout(() => notification.action(), 100);
            }
        }

        function markAllAsRead() {
            notificationsData.forEach(n => n.unread = false);
            renderNotifications();
        }

        // Initialize notifications on page load
        window.addEventListener('load', function() {
            renderNotifications();
        });

        // Staff Module Functions
        const staffData = [
            {
                id: 1,
                name: 'John Smith',
                initials: 'JS',
                role: 'Farm Manager',
                status: 'working',
                yearsEmployed: 6.8,
                holidayRemaining: 14,
                salary: 35000
            },
            {
                id: 2,
                name: 'Sarah Johnson',
                initials: 'SJ',
                role: 'Assistant Manager',
                status: 'working',
                yearsEmployed: 4.2,
                holidayRemaining: 18,
                salary: 28000
            },
            {
                id: 3,
                name: 'Mike Davis',
                initials: 'MD',
                role: 'Livestock Manager',
                status: 'working',
                yearsEmployed: 3.5,
                holidayRemaining: 12,
                salary: 26000
            },
            {
                id: 4,
                name: 'Emma Wilson',
                initials: 'EW',
                role: 'Crop Specialist',
                status: 'holiday',
                yearsEmployed: 2.1,
                holidayRemaining: 8,
                salary: 25000
            },
            {
                id: 5,
                name: 'David Brown',
                initials: 'DB',
                role: 'Machinery Operator',
                status: 'working',
                yearsEmployed: 8.3,
                holidayRemaining: 15,
                salary: 24000
            },
            {
                id: 6,
                name: 'Lisa Taylor',
                initials: 'LT',
                role: 'General Farm Worker',
                status: 'working',
                yearsEmployed: 1.7,
                holidayRemaining: 20,
                salary: 22000
            },
            {
                id: 7,
                name: 'James Anderson',
                initials: 'JA',
                role: 'General Farm Worker',
                status: 'holiday',
                yearsEmployed: 5.4,
                holidayRemaining: 5,
                salary: 22000
            },
            {
                id: 8,
                name: 'Mary Johnson',
                initials: 'MJ',
                role: 'Housekeeper',
                status: 'working',
                yearsEmployed: 12.6,
                holidayRemaining: 10,
                salary: 20000
            },
            {
                id: 9,
                name: 'Robert White',
                initials: 'RW',
                role: 'General Farm Worker',
                status: 'working',
                yearsEmployed: 0.8,
                holidayRemaining: 22,
                salary: 22000
            },
            {
                id: 10,
                name: 'Jennifer Lee',
                initials: 'JL',
                role: 'Office Administrator',
                status: 'working',
                yearsEmployed: 3.2,
                holidayRemaining: 16,
                salary: 23000
            },
            {
                id: 11,
                name: 'Thomas Clark',
                initials: 'TC',
                role: 'Maintenance Worker',
                status: 'working',
                yearsEmployed: 6.1,
                holidayRemaining: 11,
                salary: 23500
            },
            {
                id: 12,
                name: 'Patricia Martin',
                initials: 'PM',
                role: 'Seasonal Worker',
                status: 'working',
                yearsEmployed: 0.3,
                holidayRemaining: 0,
                salary: 11000
            }
        ];

        let currentStaffFilter = 'all';

        function renderStaffGrid() {
            const grid = document.getElementById('staffGrid');
            let filtered = staffData;

            // Apply filter
            if (currentStaffFilter === 'active') {
                filtered = staffData.filter(s => s.status === 'working');
            } else if (currentStaffFilter === 'holiday') {
                filtered = staffData.filter(s => s.status === 'holiday');
            } else if (currentStaffFilter === 'sick') {
                filtered = staffData.filter(s => s.status === 'sick');
            }

            grid.innerHTML = filtered.map(staff => `
                <div class="staff-card" onclick="openStaffDetail(${staff.id})">
                    <div class="staff-card-header">
                        <div class="staff-avatar">${staff.initials}</div>
                        <div class="staff-card-info">
                            <div class="staff-name">${staff.name}</div>
                            <div class="staff-role">${staff.role}</div>
                            <span class="staff-status ${staff.status}">
                                ${staff.status === 'working' ? ' Working Today' : 
                                  staff.status === 'holiday' ? ' On Holiday' : 
                                  ' Sick'}
                            </span>
                        </div>
                    </div>
                    <div class="staff-card-stats">
                        <div class="staff-stat">
                            <div class="staff-stat-label">Years Employed</div>
                            <div class="staff-stat-value">${staff.yearsEmployed} years</div>
                        </div>
                        <div class="staff-stat">
                            <div class="staff-stat-label">Holiday Remaining</div>
                            <div class="staff-stat-value">${staff.holidayRemaining} days</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterStaff(filter) {
            currentStaffFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            renderStaffGrid();
        }

        function openStaffDetail(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) return;

            // Update modal with staff data
            document.getElementById('staffDetailAvatar').textContent = staff.initials;
            document.getElementById('staffDetailName').textContent = staff.name;
            document.getElementById('staffDetailRole').textContent = staff.role;
            
            const statusElement = document.getElementById('staffDetailStatus');
            statusElement.className = `staff-status ${staff.status}`;
            statusElement.textContent = staff.status === 'working' ? 'Working Today' : 
                                       staff.status === 'holiday' ? 'On Holiday' : 'Sick';

            // Show modal
            document.getElementById('staffDetailModal').classList.add('active');
        }

        function closeStaffDetail() {
            document.getElementById('staffDetailModal').classList.remove('active');
        }

        function switchStaffTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.staff-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.staff-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'personal') {
                document.getElementById('staffPersonalTab').classList.add('active');
            } else if (tabName === 'employment') {
                document.getElementById('staffEmploymentTab').classList.add('active');
            } else if (tabName === 'leave') {
                document.getElementById('staffLeaveTab').classList.add('active');
            } else if (tabName === 'documents') {
                document.getElementById('staffDocumentsTab').classList.add('active');
            } else if (tabName === 'notes') {
                document.getElementById('staffNotesTab').classList.add('active');
            }
        }

        function openAddStaffModal() {
            alert('Add Staff Member\n\nThis would open a form to add a new staff member with fields:\n- Personal information\n- Employment details\n- Salary information\n- Emergency contacts');
        }

        function viewStaffRota() {
            alert('Staff Rota\n\nThis would open a weekly grid view showing:\n- Who is working each day\n- Shift times\n- Holiday/sick days\n- Drag-and-drop to edit\n- Print/export functionality');
        }

        // Close staff detail modal on overlay click
        document.getElementById('staffDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStaffDetail();
            }
        });

        // Machinery Module Functions
        const machineryData = [
            // Tractors
            {
                id: 1,
                name: 'John Deere 6155R',
                category: 'tractors',
                icon: '',
                make: 'John Deere',
                model: '6155R',
                year: 2019,
                status: 'active',
                hours: 2450,
                nextServiceHours: 2900,
                purchasePrice: 95000
            },
            {
                id: 2,
                name: 'Massey Ferguson 5713',
                category: 'tractors',
                icon: '',
                make: 'Massey Ferguson',
                model: '5713',
                year: 2020,
                status: 'active',
                hours: 1850,
                nextServiceHours: 2400,
                purchasePrice: 68000
            },
            {
                id: 3,
                name: 'New Holland T6.180',
                category: 'tractors',
                icon: '',
                make: 'New Holland',
                model: 'T6.180',
                year: 2018,
                status: 'barn',
                hours: 3200,
                nextServiceHours: 3600,
                purchasePrice: 82000
            },
            {
                id: 4,
                name: 'Case IH Puma 185',
                category: 'tractors',
                icon: '',
                make: 'Case IH',
                model: 'Puma 185',
                year: 2021,
                status: 'active',
                hours: 1200,
                nextServiceHours: 1800,
                purchasePrice: 92000
            },
            {
                id: 5,
                name: 'Fendt 516 Vario',
                category: 'tractors',
                icon: '',
                make: 'Fendt',
                model: '516 Vario',
                year: 2017,
                status: 'maintenance',
                hours: 4100,
                nextServiceHours: 4200,
                purchasePrice: 75000
            },
            // Mowers
            {
                id: 6,
                name: 'Kuhn GMD 3150',
                category: 'mowers',
                icon: '',
                make: 'Kuhn',
                model: 'GMD 3150',
                year: 2020,
                status: 'barn',
                hours: 450,
                nextServiceHours: 600,
                purchasePrice: 12000
            },
            {
                id: 7,
                name: 'JF FCT 900',
                category: 'mowers',
                icon: '',
                make: 'JF',
                model: 'FCT 900',
                year: 2019,
                status: 'active',
                hours: 380,
                nextServiceHours: 600,
                purchasePrice: 9500
            },
            {
                id: 8,
                name: 'Vicon Extra 432',
                category: 'mowers',
                icon: '',
                make: 'Vicon',
                model: 'Extra 432',
                year: 2021,
                status: 'barn',
                hours: 220,
                nextServiceHours: 600,
                purchasePrice: 11000
            },
            // Seeders
            {
                id: 9,
                name: 'Vaderstad Rapid 400S',
                category: 'seeders',
                icon: '',
                make: 'Vaderstad',
                model: 'Rapid 400S',
                year: 2019,
                status: 'barn',
                hours: 180,
                nextServiceHours: 300,
                purchasePrice: 45000
            },
            {
                id: 10,
                name: 'Amazone Cirrus 6003',
                category: 'seeders',
                icon: '',
                make: 'Amazone',
                model: 'Cirrus 6003',
                year: 2020,
                status: 'barn',
                hours: 150,
                nextServiceHours: 300,
                purchasePrice: 38000
            },
            // Vehicles
            {
                id: 11,
                name: 'Ford Ranger',
                category: 'vehicles',
                icon: '',
                make: 'Ford',
                model: 'Ranger',
                year: 2022,
                status: 'active',
                hours: 0,
                nextServiceDays: 90,
                purchasePrice: 35000
            },
            {
                id: 12,
                name: 'Toyota Hilux',
                category: 'vehicles',
                icon: '',
                make: 'Toyota',
                model: 'Hilux',
                year: 2020,
                status: 'active',
                hours: 0,
                nextServiceDays: 45,
                purchasePrice: 32000
            },
            {
                id: 13,
                name: 'Land Rover Defender',
                category: 'vehicles',
                icon: '',
                make: 'Land Rover',
                model: 'Defender 110',
                year: 2021,
                status: 'active',
                hours: 0,
                nextServiceDays: 120,
                purchasePrice: 48000
            },
            {
                id: 14,
                name: 'Isuzu D-Max',
                category: 'vehicles',
                icon: '',
                make: 'Isuzu',
                model: 'D-Max',
                year: 2019,
                status: 'maintenance',
                hours: 0,
                nextServiceDays: 0,
                purchasePrice: 28000
            },
            // Other Equipment
            {
                id: 15,
                name: 'Kverneland ES100 Plough',
                category: 'other',
                icon: '',
                make: 'Kverneland',
                model: 'ES100',
                year: 2018,
                status: 'barn',
                hours: 320,
                nextServiceHours: 600,
                purchasePrice: 8500
            },
            {
                id: 16,
                name: 'Amazone ZA-M fertiliser spreader',
                category: 'other',
                icon: '',
                make: 'Amazone',
                model: 'ZA-M 1501',
                year: 2019,
                status: 'barn',
                hours: 180,
                nextServiceHours: 300,
                purchasePrice: 12000
            },
            {
                id: 17,
                name: 'Claas Rollant 520 Baler',
                category: 'other',
                icon: '',
                make: 'Claas',
                model: 'Rollant 520',
                year: 2020,
                status: 'barn',
                hours: 280,
                nextServiceHours: 600,
                purchasePrice: 28000
            },
            {
                id: 18,
                name: 'McHale F550 Wrapper',
                category: 'other',
                icon: '',
                make: 'McHale',
                model: 'F550',
                year: 2020,
                status: 'barn',
                hours: 250,
                nextServiceHours: 600,
                purchasePrice: 15000
            },
            {
                id: 19,
                name: 'Bomford Turner Hedge Cutter',
                category: 'other',
                icon: '',
                make: 'Bomford',
                model: 'Turner B54',
                year: 2017,
                status: 'barn',
                hours: 420,
                nextServiceHours: 600,
                purchasePrice: 6500
            },
            {
                id: 20,
                name: 'Logic TRM160 Topper',
                category: 'other',
                icon: '',
                make: 'Logic',
                model: 'TRM160',
                year: 2019,
                status: 'barn',
                hours: 380,
                nextServiceHours: 600,
                purchasePrice: 4200
            },
            {
                id: 21,
                name: 'Spaldings 2000L Sprayer',
                category: 'other',
                icon: '',
                make: 'Spaldings',
                model: '2000L',
                year: 2018,
                status: 'barn',
                hours: 290,
                nextServiceHours: 600,
                purchasePrice: 8800
            },
            {
                id: 22,
                name: 'Ifor Williams Livestock Trailer',
                category: 'other',
                icon: '',
                make: 'Ifor Williams',
                model: 'TA510G',
                year: 2019,
                status: 'barn',
                hours: 0,
                nextServiceDays: 180,
                purchasePrice: 9500
            },
            {
                id: 23,
                name: 'JCB Telehandler 531-70',
                category: 'other',
                icon: '',
                make: 'JCB',
                model: '531-70',
                year: 2020,
                status: 'active',
                hours: 850,
                nextServiceHours: 1200,
                purchasePrice: 42000
            }
        ];

        let currentMachineryFilter = 'all';

        function renderMachineryGrid() {
            const grid = document.getElementById('machineryGrid');
            let filtered = machineryData;

            // Apply filter
            if (currentMachineryFilter !== 'all') {
                filtered = machineryData.filter(m => m.category === currentMachineryFilter);
            }

            grid.innerHTML = filtered.map(machine => {
                const hoursRemaining = machine.nextServiceHours ? machine.nextServiceHours - machine.hours : null;
                const daysRemaining = machine.nextServiceDays;
                let serviceDueText = '';
                let serviceDueClass = '';

                if (hoursRemaining !== null) {
                    if (hoursRemaining <= 50) {
                        serviceDueText = ` Service due in ${hoursRemaining} hours`;
                        serviceDueClass = 'urgent';
                    } else if (hoursRemaining <= 150) {
                        serviceDueText = ` Service due in ${hoursRemaining} hours`;
                    }
                } else if (daysRemaining !== undefined) {
                    if (daysRemaining <= 0) {
                        serviceDueText = ' Service overdue';
                        serviceDueClass = 'urgent';
                    } else if (daysRemaining <= 30) {
                        serviceDueText = ` Service due in ${daysRemaining} days`;
                        serviceDueClass = 'urgent';
                    } else if (daysRemaining <= 90) {
                        serviceDueText = ` Service due in ${daysRemaining} days`;
                    }
                }

                return `
                    <div class="machinery-card" onclick="openMachineryDetail(${machine.id})">
                        <div class="machinery-card-header">
                            <div class="machinery-icon">${machine.icon}</div>
                            <div class="machinery-card-info">
                                <div class="machinery-name">${machine.name}</div>
                                <div class="machinery-model">${machine.make} ${machine.model}  ${machine.year}</div>
                                <span class="machinery-status ${machine.status}">
                                    ${machine.status === 'active' ? ' Active' :
                                      machine.status === 'barn' ? ' In Barn' :
                                      machine.status === 'maintenance' ? ' In Maintenance' :
                                      ' Sold'}
                                </span>
                            </div>
                        </div>
                        <div class="machinery-card-details">
                            ${machine.hours > 0 ? `
                                <div class="machinery-detail">
                                    <div class="machinery-detail-label">Hours</div>
                                    <div class="machinery-detail-value">${machine.hours.toLocaleString()}</div>
                                </div>
                            ` : ''}
                            <div class="machinery-detail">
                                <div class="machinery-detail-label">Purchase Price</div>
                                <div class="machinery-detail-value">${machine.purchasePrice.toLocaleString()}</div>
                            </div>
                            ${serviceDueText ? `
                                <div class="machinery-service-due ${serviceDueClass}">${serviceDueText}</div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterMachinery(category) {
            currentMachineryFilter = category;

            // Update filter buttons
            document.querySelectorAll('.machinery-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderMachineryGrid();
        }

        function openMachineryDetail(machineryId) {
            const machine = machineryData.find(m => m.id === machineryId);
            if (!machine) return;

            // Update modal with machinery data
            document.getElementById('machineryDetailIcon').textContent = machine.icon;
            document.getElementById('machineryDetailName').textContent = machine.name;
            document.getElementById('machineryDetailModel').textContent = 
                `${machine.make} ${machine.model}  ${machine.year}`;

            const statusElement = document.getElementById('machineryDetailStatus');
            statusElement.className = `machinery-status ${machine.status}`;
            statusElement.textContent = 
                machine.status === 'active' ? ' Active' :
                machine.status === 'barn' ? ' In Barn' :
                machine.status === 'maintenance' ? ' In Maintenance' :
                ' Sold';

            // Show modal
            document.getElementById('machineryDetailModal').classList.add('active');
        }

        function closeMachineryDetail() {
            document.getElementById('machineryDetailModal').classList.remove('active');
        }

        function switchMachineryTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.machinery-tab-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.machinery-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            if (tabName === 'basic') {
                document.getElementById('machineryBasicTab').classList.add('active');
            } else if (tabName === 'specs') {
                document.getElementById('machinerySpecsTab').classList.add('active');
            } else if (tabName === 'service') {
                document.getElementById('machineryServiceTab').classList.add('active');
            } else if (tabName === 'costs') {
                document.getElementById('machineryCostsTab').classList.add('active');
            } else if (tabName === 'documents') {
                document.getElementById('machineryDocumentsTab').classList.add('active');
            }
        }

        function selectServiceInterval(element, type) {
            // Remove selected class from all options
            document.querySelectorAll('.service-interval-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            // Add selected class to clicked option
            element.classList.add('selected');

            // In real app, would save this preference and recalculate next service date
            console.log('Service interval set to:', type);
        }

        function openAddMachineryModal() {
            alert('Add Equipment\n\nThis would open a form to add new equipment with fields:\n- Basic information\n- Specifications\n- Purchase details\n- Service schedule settings');
        }

        function viewServiceSchedule() {
            alert('Service Schedule Calendar\n\nThis would open a calendar view showing:\n- All equipment service due dates\n- Color coded by urgency\n- Filter by equipment type\n- Export to calendar apps\n- Automatic alerts/reminders');
        }

        // Close machinery detail modal on overlay click
        document.getElementById('machineryDetailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMachineryDetail();
            }
        });

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        // Close mobile menu when switching views
        const originalSwitchView = switchView;
        switchView = function(view) {
            originalSwitchView.call(this, view);
            closeMobileMenu();
        };

        // Estate stat drill-down functions
        function drillDownEstateStat(statType) {
            const statData = {
                'total': {
                    title: 'Total Estate Breakdown',
                    subtitle: '567 hectares',
                    items: [
                        { name: 'Grassland', value: '360ha', percent: '63.5%' },
                        { name: 'Crops', value: '125ha', percent: '22.0%' },
                        { name: 'Forestry', value: '65ha', percent: '11.5%' },
                        { name: 'Buildings & Yards', value: '17ha', percent: '3.0%' }
                    ]
                },
                'grassland': {
                    title: 'Grassland Breakdown',
                    subtitle: '360 hectares',
                    items: [
                        { name: 'Permanent Pasture', value: '240ha', detail: '12 fields' },
                        { name: 'Temporary Grassland', value: '85ha', detail: '4 fields' },
                        { name: 'Meadow', value: '35ha', detail: '2 fields' }
                    ]
                },
                'crops': {
                    title: 'Crop Breakdown',
                    subtitle: '125 hectares',
                    items: [
                        { name: 'Winter Wheat', value: '62ha', detail: 'South Crops' },
                        { name: 'Spring Barley', value: '38ha', detail: 'East Field' },
                        { name: 'Oilseed Rape', value: '25ha', detail: 'North Crops' }
                    ]
                },
                'forestry': {
                    title: 'Forestry Breakdown',
                    subtitle: '65 hectares',
                    items: [
                        { name: 'Mixed Woodland', value: '45ha', detail: 'Established' },
                        { name: 'New Planting', value: '20ha', detail: 'Year 2' }
                    ]
                },
                'buildings': {
                    title: 'Buildings & Infrastructure',
                    subtitle: '17 hectares',
                    items: [
                        { name: 'Main Barn Complex', value: '8ha', detail: 'Operational' },
                        { name: 'Yards & Access', value: '6ha', detail: 'Hardstanding' },
                        { name: 'Residential', value: '3ha', detail: '2 properties' }
                    ]
                },
                'livestock': {
                    title: 'Livestock Breakdown',
                    subtitle: '400 head',
                    items: [
                        { name: 'Cattle', value: '280 head', detail: 'Main Herd A & B' },
                        { name: 'Sheep', value: '120 head', detail: 'Breeding Ewes' }
                    ]
                }
            };

            const data = statData[statType];
            if (!data) return;

            alert(`${data.title}\n${data.subtitle}\n\n${data.items.map(i => 
                `${i.name}: ${i.value}${i.detail ? ' - ' + i.detail : ''}${i.percent ? ' (' + i.percent + ')' : ''}`
            ).join('\n')}\n\nIn the full app, this would open a detailed breakdown modal.`);
        }

        // Add custom cost category modal
        function openAddCategoryModal() {
            alert('Add Custom Cost Category\n\nThis would open a form to create a new cost category with:\n- Category name\n- Color coding\n- Budget allocation\n- Type (Cost/Revenue)\n\nExamples:\n- Fertilizer costs\n- Utilities\n- Insurance\n- Custom categories specific to your operation');
        }

        // Initialize column counts
        updateColumnCounts();

        console.log('SoilArk Demo Loaded Successfully!');
        console.log('Features:');
        console.log('- Interactive map with clickable fields');
    </script>
    </body>
